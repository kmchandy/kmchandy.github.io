<title>ReviewOfBasics/ExamplesCorrectnessProofs/DetailedExample.html</title>
<!------------- Start Heading -------------------------------->
<!DOCTYPE html>

<html lang="en">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet"
href="https://www.w3schools.com/w3css/4/w3.css">

<link rel="stylesheet"
href="https://fonts.googleapis.com/css?family=Roboto">

<link rel="stylesheet"
href="https://www.w3schools.com/lib/w3-theme-blue.css">

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<style>
html,body,h1,h2,h3,h4,h5,h6 {font-family: "Roboto", sans-serif;}
.w3-sidebar {
  z-index: 3;
  width: 250px;
  top: 43px;
  bottom: 0;
  height: inherit;
}
/* Thick blue border */
hr.new2 {
  border: 2px solid blue;
}
/* blue border */
hr.new1 {
  border: 2px solid blue;
}
</style>


<body>
<div class="w3-top">
<div class="w3-bar w3-theme w3-top w3-left-align w3-large">
  
  <a class="w3-bar-item w3-button w3-right w3-hide-large
  w3-hover-white w3-large w3-theme-l1"
  href="javascript:void(0)"
  onclick="w3_open()">
  <i class="fa fa-bars"></i></a>

  <a href="../../index.html"
  class="w3-bar-item w3-button w3-hide-small w3-hover-white">
  Distributed Algorithms
  </a>

  <a href="../../table_of_contents.html"
  class="w3-bar-item w3-button w3-hide-small w3-hover-white">
  Contents
  </a>

  <a href="../../cross_reference.html"
  class="w3-bar-item w3-button w3-hide-small w3-hover-white">
  Index
  </a>
    
  </div>
  </div>

<nav
class="w3-sidebar w3-bar-block w3-collapse w3-large w3-theme-l5
w3-animate-left" 
id="mySidebar">

<a href="javascript:void(0)"
onclick="w3_close()"
class="w3-right w3-xlarge w3-padding-large w3-hover-black
w3-hide-large"
title="Close Menu">
<i class="fa fa-remove"></i>
</a>

<!--END Heading  ---------------------------->
 
<!-- Start Sidebar----------> 
 
<a class="w3-bar-item w3-button w3-hover-black "
href="../../Introduction/Introduction.html" > 
CHAPTER: Review Sequential Programming
</a>
<a class="w3-bar-item w3-button w3-hover-black "
href="../../ExamplesCorrectnessProofs/ExamplesCorrectnessProofs.html" > 
Correctness Proofs: Examples
</a>
<a class="w3-bar-item w3-button w3-hover-black "
href="../Sorting/Sorting.html" > 
Sorting
</a>
<a class="w3-bar-item w3-button w3-hover-black "
href="../ShortestPath/ShortestPath.html" > 
Shortest Path
</a>
<a class="w3-bar-item w3-button w3-hover-black "
href="../AverageOfSensors/AverageOfSensors.html" > 
Distributed Averaging
</a>
<a class="w3-bar-item w3-button w3-hover-black "
href="../FlightFormation/FlightFormation.html" > 
Flight Formation
</a>
<a class="w3-bar-item w3-button w3-hover-black "
href="../EarliestMeetingTime/EarliestMeetingTime.html" > 
Schedule Earliest Meeting
</a>

</nav>
<!-- End Sidebar---------->
 
<!-- Start overlay ---------------------------------->

<!-- Overlay effect when opening sidebar on small screens -->
<div class="w3-overlay w3-hide-large"
  onclick="w3_close()"
  style="cursor:pointer"
  title="close side menu"
  id="myOverlay"></div>

<!-- Main content: shift it to the right by 250 pixels when the sidebar is visible -->
<div class="w3-main" style="margin-left:250px">
  
<script id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
  
<div class="w3-row w3-padding-64">
<div class="w3-twothird w3-container">

<!-- End overlay ---------------------------------->
<!--------------------------------------------------------->
    <h1 class="w3-text-teal">Detailed Example: Earliest Meeting Time</h1>
    We first consider a specific example and then generalize it.
    Three agents - Maya, Liu, and Eve - want to find a day at which
    all of them can meet. Associated with each agent \(j\) is a
    function \(f_{j}\) where \(f_{j}(d)\) is the
    earliest day at or after day \(d\) that agent \(j\) can meet.
    </p>
    

    <p>
    For example, assume that Maya, Liu and Eve are agents \(0\), \(1\),
    and \(2\), respectively. Maya, Liu and Eve can only meet on days that are multiples
    of 2, 3, 5, respectively (but none can meet on day 0).
    For example, \(f_{0}(5) = 6\) because the earliest time that Maya can meet on or after day
    5 is day 6, because she cannot meet on day 5 since 5 is not a
    multiple of 2, and she can meet on day 6.
    Here are some examples of values of \(f_{j}(d)\):
    </p>

    <p>
    \(
    f_{0}(5) = 6, \; f_{0}(6) = 6, \; f_{0}(7) = 8
    \)
    <br>
    \(
    f_{1}(5) = 6, \;  f_{1}(6) = 6, \; f_{1}(7) = 9
    \)
    <br>
    \(
    f_{2}(5) = 5, \; f_{2}(6) = 10, \; f_{2}(7) = 10
    \)
    </p>

    <p>
    In the example, the earliest day that Maya, Liu and Eve can all meet is the least
    common multiple of 2, 3, and 5 which is 30.
    <p>
    
    <p>
    The function \(f_{j}\) is private to agent \(j\). An agent
    doesn't know the function of other agents.
    There exists some day, perhaps in the distant future, at which all
    agents can meet, and that day is \(m\). Therefore:
    
    <ol>
      <li>
      <p>
      All agents can meet on day \(m\).
      </p>
      \(
      \forall j: f_{j}(m) = m
      \)
      </p>
      </li>
      <li>
      For every day \(d\) before \(m\), at least one agent cannot meet
      at \(t\). 
      </p>
      <p>
    \(
    \forall d < m: \exists j:  f_{j}(d) > d
      \)
      </p>
      </li>
  </ol>
    

    <p>
  Associated with agent \(j\) is a variable \(t_{j}\).
  Let \(N\) be the number of agents, and
  let \(t\) be the vector whose elements are \(t_{j}\).
  Let \(M\) and  \(\emptyset\) be vectors of length \(N\) where
  all elements of \(M\) are \(m\) and all elements of \(\emptyset\)
  are \(0\).
  In our example, \(t = [t_{0}, t_{1}, t_{2}]\),
  \(M = [30, 30, 30]\), and \(\emptyset = [0, 0, 0]\). 
  </p>

  <p class="w3-text-teal">Specification</p>
  <p>
  The specification of the system is as follows.
  The system is modeled as a do-od loop.Initially \(t = \emptyset\).
  Execution of the
  loop must terminate, and \(t = M\) at termination.
  </p>

    <h4 class="w3-text-teal">The Agent Graph</h4>
    In this example, Maya and Liu communicate with Eve, but not with
    each other. The agent graph is shown below. The system has three
    agents - Maya, Liu and Eve -  and shared variables \(t_{0}\),
    \(t_{1}\) and \(t_{2}\). 

    <figure>
    <img src="MayaLiuEve.jpg" alt="Fig1" style="width:80%">>
    <figcaption>Fig.1: The Agent Graph</figcaption>
    </figure>

    <p>
    Eve's proposed meeting time, \(t_{2}\), is written by Eve and read by Maya and
  Liu. Likewise \(t_{0}\) is written by Maya and read by Eve, and 
  \(t_{1}\) is written by Liu and read by Eve.
  

  <h4 class="w3-text-teal"> General Case</h4>
  In the general case the agent graph has an arbitrary number of
  agents. The agent graph is strongly connected, i.e. there exists a
  path from every vertex to every other vertex.

  <h4 class="w3-text-teal">Agent's Algorithm</h4>
  This problem has many algorithms. We give an example algorithm that
  illustrates how agent
  states appear in timeline diagrams.

  Each agent \(j\) writes variable \(t_{j}\). For every edge
  \((i, j)\) in the graph, agent \(j\) reads variable  \(t_{i}\).

  <p class="w3-text-teal">Agent's Input/Output Operations</p>
  There are many types of shared variables. The type we use most often
  in this course is a message-passing channel. In this example, we
look at a simple type of shared variable.

<p>
  Agent \(j\) has a local variable \(w_{j}\), and a local variable \(r_{i, j}\) for every edge \((i,
  j)\),
  where the symbols \(r\) and \(w\) stand for read and write,
  respectively. These variables are 0 initially.
  Agent \(j\) copies shared variable \(t_{i}\) into local
  variable \(r_{i, j}\), and it copies local variable \(w_{j}\)
  into shared variable \(t_{j}\).  The guarded commands for these operations are:
</p>

<p>
\(
\textbf{if} \; r_{i, j} \neq t_{i} \; \textbf{then} \; r_{i, j} =
t_{i}
\) 
</p>

<p>
\(
\textbf{if} \;  t_{j} \neq w_{j}   \; \textbf{then} \; t_{j} =
w_{j} 
\)


<p>
We postpone discussion of how these operation that interface between
local and shared variables are implemented. Propose a couple of
implementations using multiple concurrent threads or a single
loop of execution.

    <figure>
    <img src="MayaLiuEveLocalSharedVariables.jpg" alt="Fig1" style="width:80%">>
    <figcaption>Fig.2: Local and Shared Variables</figcaption>
    </figure>

<p>
Note that with this input/output structure, values can get lost. For
example, suppose \(w_{j}\) is 0 and then 1. Agent \(j\) may write 1
into shared variable \(t_{j}\) before agent \(k\) copies value 0 into
its local variable \(r_{j, k}\).

<p>
When the shared variable is a queue of messages, the action of copying
values between local and shared variables reduces to copying only the
sequence of uncopied messages. We will discuss shared variable types later.



<h4 class="w3-text-teal">Local Step of an Agent</h4>
Agent \(j\) executes the following step:
<p>

\(
\textbf{if} \;  t_{j} <  f_{j}(\textrm{max}_{i} r_{i,j})   \; \textbf{then} \;
t_{j} = f_{j}(\textrm{max}_{i} r_{i,j})
\)

<p>
The guarded commands of the system consists of the commands that copy
values between local and shared variables, and the local steps of
agents. Any command whose guard is true may be executed at each step. Only one command is executed at a
time. However, you can see that two commands can be executed in either
order if neither command modifies a variable that is referenced by the
other. Execution in either order is a proxy for concurrent execution.

<p>
Later we will discuss methods by which all agents operate
concurrently, and use protocols to ensure that a variable that is
modified in one command is not referenced at the same time by another
command.  


<h4 class="w3-text-teal">The State Transition Graph</h4>
The  graph is too large to fit conveniently into this module. The
state of the system is a tuple containing the state of each agent and
the state of each shared variable. The state of agent \(j\) is given
by the values of \(r_{i,j}\) and \(w_{j}\), and the state of shared
variable \(t_{j}\) is its value.

<h4 class="w3-text-teal">The Timeline</h4>
An example of a partial timeline, only for agents 0 and 1, is shown in
the figure below. The timelines for agents are in blue and timelines
for shared variables in red. An internal event is the execution of a
command that only references local variables of an agent, and that
does not reference shared variables.

    <figure>
    <img src="MayaLiuEveTimeline.jpg" alt="Fig3" style="width:100%">
    <figcaption>Fig.3: Example Timeline</figcaption>
</figure>

An example of an internal event is agent 0 changing \(w_{0}\) from 0
to 2. The timeline also shows events in which an agent reads a shared
variable and copies it into a local variable, and events in which an
agent writes a local variable into a shared variable.

<h3 class="w3-text-teal">Proof of Correctness</h3>
The proof of correctness of a loop hinges on finding an invariant and
a variant function.
We use a <a href="../Module_004/LoopTermination.html">variant
function</a> to prove that execution of a loop terminates.
At termination, we use an
<a href="../Module_003/Safety.html">invariant</a> coupled with all
guards being false to prove the desired property.

You can find several examples of invariants and
variant functions. Here is one example.

<p>
Let \(S\) be a tuple which has an element for each shared
variable \(t_{j}\), and local variables \(r_{i,j}\) and \(w_{j}\), for
all \(i, j\). Let \(M\) be a tuple, of the same size as \(S\), where
all the elements of \(M\) are the earliest meeting time \(m\). Let
\(\emptyset\) be a tuple, of the same size as \(S\), where
all the elements of \(emptyset\) are \(0\).
We compare tuples lexicographically.

<p class="w3-text-teal">Invariant</p>
It is straightforward to
prove the following is an invariant.
<p>
\(
\emptyset \leq S \leq M
\)
<p>
The invariant says that no local or shared variable overshoots the
earliest meeting time \(m\), and they remain nonnegative.

<p class="w3-text-teal">Variant Function</p>
Recall from the
<a href="../Module_004/LoopTermination.html"><i>module on proving loop
termination</i></a>, we can use a variant function \(f\) and an
invariant \(I\) in the following way. We prove that execution of a
loop terminates by proving:
</p>
<p>
\(
\forall K: \quad
(f=K) \wedge I \wedge (\exists j: g_{j})
\quad \rightarrow \quad f < K
\)

<p>
An example of a variant function is \(M-S\). Its values are tuples of integers, and
the invariant implies that it is bounded below by \(\emptyset\).
We leave it to you to prove the above formula with \(f = M - S\).
It is easy to see that the execution of any command with a true guard increases
\(S\), and therefore decreases \(M-S\).


<!---------------------------------------->
<h4 class="w3-text-teal">Practicalities</h4>
<p>
The model executes one action at a time.
Actions that can be executed in arbitrary order represent actions that
can be executed concurrently.
A set of
actions can execute concurrently provided that no action in the set modifies
variables that are accessed by other actions in the set.
We must ensure that an agent does not access a variable that is being
modified by another agent by using locks or message-passing. We will
discuss variables shared by agents in the next two sections.
</p>
<!--Start Footer--------------------------------------->

    <hr class="new1">
      <p>K. Mani Chandy,
      Emeritus Simon Ramo Professor,
      California Institute of Technology</p>
    
</footer>
    


<!-- END MAIN -->
</div>

<script>
// Get the Sidebar
var mySidebar = document.getElementById("mySidebar");

// Get the DIV with overlay effect
var overlayBg = document.getElementById("myOverlay");

// Toggle between showing and hiding the sidebar, and add overlay effect
function w3_open() {
  if (mySidebar.style.display === 'block') {
    mySidebar.style.display = 'none';
    overlayBg.style.display = "none";
  } else {
    mySidebar.style.display = 'block';
    overlayBg.style.display = "block";
  }
}

// Close the sidebar with the close button
function w3_close() {
  mySidebar.style.display = "none";
  overlayBg.style.display = "none";
}
</script>

</body>
</html>
