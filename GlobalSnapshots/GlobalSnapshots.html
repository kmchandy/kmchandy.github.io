<!DOCTYPE html>
<html lang="en">
<title>GlobalSnapshots</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
html,body,h1,h2,h3,h4,h5,h6 {font-family: "Roboto", sans-serif;}
.w3-sidebar {
  z-index: 3;
  width: 250px;
  top: 43px;
  bottom: 0;
  height: inherit;
}
</style>
<body>


<!-- Navbar -->
<div class="w3-top">
  <div class="w3-bar w3-theme w3-top w3-left-align w3-large">
    <a class="w3-bar-item w3-button w3-right w3-hide-large w3-hover-white w3-large w3-theme-l1" href="javascript:void(0)" onclick="w3_open()"><i class="fa fa-bars"></i></a>
    <a href="../index.html" class="w3-bar-item w3-button w3-hide-small
    w3-hover-white">About the Course</a>
    <a href="../table_of_contents.html" class="w3-bar-item w3-button w3-hide-small
    w3-hover-white">Table of Contents</a>
    <a href="../cross_reference.html" class="w3-bar-item w3-button w3-hide-small w3-hover-white">Index</a>
  </div>
  </div>
 

<!-- Sidebar -->
<nav class="w3-sidebar w3-bar-block w3-collapse w3-large w3-theme-l5 w3-animate-left" id="mySidebar">
  <a href="javascript:void(0)" onclick="w3_close()" class="w3-right w3-xlarge w3-padding-large w3-hover-black w3-hide-large" title="Close Menu">
    <i class="fa fa-remove"></i>
  </a>

  <!-------------------------->
  <h3 class="w3-bar-item"><b>An Introduction to Distributed
  Algorithms</h3>
  
  <a class="w3-bar-item w3-button w3-hover-black"
  href="GlobalSnapshots.html">Global Snapshots</a>

  <a class="w3-bar-item w3-button w3-hover-black"
  href="GlobalSnapshotsExample.html">Examples</a>

  <a class="w3-bar-item w3-button w3-hover-black"
  href="GlobalSnapshotsSelfTest.html">Self Test</a>

  <a class="w3-bar-item w3-button w3-hover-black"
  href="PropertiesOfTimelinesExercises.html">Exercises</a>

  <a class="w3-bar-item w3-button w3-hover-black"
  href="GlobalSnapshots.html">Explorations</a>

  <a class="w3-bar-item w3-button w3-hover-black"
  href="../PropertiesOfGlobalSnapshots/PropertiesOfGlobalSnapshots.html">
  Next: Properties of Global Snapshots</a> 
  
  <a class="w3-bar-item w3-button w3-hover-black"
  href="../LogicalClocks/LogicalClocks.html">Previous:
  Timestamps and Logical Clocks
  </a>
  
</nav>

<!-- Overlay effect when opening sidebar on small screens -->
<div class="w3-overlay w3-hide-large" onclick="w3_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>

<!-- Main content: shift it to the right by 250 pixels when the sidebar is visible -->
<div class="w3-main" style="margin-left:250px">
  
<script id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
  
  <div class="w3-row w3-padding-64">
  <div class="w3-twothird w3-container">

    <!--------------------------------------------------------->
    <h1 class="w3-text-teal">Global Snapshots</h1><p>

    The <i>global state</i> or system state is a tuple which contains
    an element for the state of each agent and the value of each
    shared variable of the system. We use the term, <i>global</i>, to
    emphasize that this state is for the entire system.

    <p>
    A previous module showed the pictorial representation of a global
    state at an instant in the trajectory.
    When agent and variable timelines are horizontal,
    an instant corresponds to a vertical line cutting through the
    horizontal timelines.
    The global state at an instant
    is the tuple of labels of edges on agent and
    shared-variable timelines that are cut by the line corresponding
    to that instant. The figure below shows a vertical line
    representing an instant T and shows the global state at T. 

    <figure>
    <img src="SystemStateAtT_Slide4.jpg" alt="Fig1" style="width:50%">
    <figcaption>Fig.1: Global state at an instant T</figcaption>
    </figure>
    
    <p>
    Agents don't have perfectly synchronized clocks.  If each agent recorded its
    local state when its local clocks was at a value \(T\), then the
    tuple of recordings may not represent a state that occurs in any
    trajectory. This is because the instant at which one
    local clock has value \(T\) may be different from the instant at
    which another clock has that value.  In terms of the timeline
    graph, there's no algorithm by which agents can cut horizontal
    timelines with a perfectly vertical line.

    <p>
    Instead of determining the global state at an instant T, let's
    look at an algorithm that solves a simpler problem: <i>Develop an algorithm by which
    agents determine the global state corresponding to a consistent cut.</i>
    
    

    <h3 class="w3-text-teal">A Global Snapshot Algorithm</h3>
    <p class="w3-text-teal">Algorithm specification</p>
    The algorithm must terminate. At termination the recorded
    states of agents and shared variables must be a global snapshot
    corresponding to a consistent cut of the timeline graph.


<p class="w3-text-teal">The idea</p>
The idea is that an agent \(a\) takes the following steps before it
takes an action.
<ol>
  <li>
  If agent \(a\) hasn't taken its local snapshot and it
  references a snapped variable then \(a\) takes snapshots of itself
  and all unsnapped variables that it references in the action.
  </li>
  <li>
  If \(a\) has taken its local snapshot then \(a\) takes snapshots of
  all unsnapped variables that it references in the action.
  </li>
</ol>



    <p class="w3-text-teal">Variables in the algorithm</p>
Let \(a.snap\) and \(v.snap\) be the values recorded by the algorithm
    for the states of agent \(a\) and shared variable \(v\),
respectively; these values are undefined initially.


    <p class="w3-text-teal">Initiation</p>
    The algorithm starts when an agent records its
state. An agent \(a\) records its state by 
setting \(a.snap\) to \(a\)'s state.

Any set of agents can initiate the algorithm.
Later, we will discuss what makes an agent initiate the algorithm.

<p class="w3-text-teal">An agent's actions</p>
Modify the action of an agent \(a\) in the following ways. Let
<i>references</i> be the set of variables 
referenced in the action. 
  

<pre>
if a.snap is undefined:
   if exists v in references such that v.snap is defined:
       copy a's state into a.snap;
   for all v in references for which v.snap is undefined:
       copy v's value into v.snap
else:
   for all v in references for which v.snap is undefined:
       copy v's value into v.snap
</pre>


<p class="w3-text-teal">Termination</p>
The global snapshot algorithm terminates if local snapshots have been taken of all
agents and shared variables. So, if all agents execute actions, and
all shared variables are referenced, during
a trajectory, then the algorithm terminates. 


<h2 style="color:red;">Example</h2>
The following series of diagrams shows how agent and shared-variable
states are recorded during a trajectory. The first diagram shows the
recording algorithm being initiated by one or more agents recording
their states. In this example, the algorithm is initiated by agent
\(C\) recording its state after event 0 and before event 1. \(A\)'s
recorded state is shown by the black dot on \(A\)'s timeline.

<p>
This recording that initiates the algorithm is carried out independent
of the execution of any action.
    
<figure>
    <img src="AgentTimeline_08.jpg" alt="Fig1" style="width:80%">
    <figcaption>Fig.2: Example - Recording algorithm is initiated</figcaption>
</figure>

During event 1, agent \(A\) references variable \(v\).
Since the states of \(A\)  and \(v\) have not
been recorded at this point, the execution of event 1 causes no
additional recordings.

<p>
All events executed by \(A\) before it records its state are in the
past with respect to this recording. Past events are colored black. An
event is in the past exactly when the states of the agent executing
the action and the variables referenced in the action haven't been
recorded. 

<p>
In event 2, agent \(C\) references variable \(w\). Since
\(C\)'s state has been recorded, \(C\) records the state of  \(w\)
before executing event 2 --- see rule 2 of the algorithm. The state of
\(w\) that is recorded is shown by a black dot.

<figure>
    <img src="AgentTimeline_09.jpg" alt="Fig1" style="width:80%">
    <figcaption>Fig.2: Example - Event 2</figcaption>
</figure>

<p>
In event 3, agent \(A\) references variable \(w\). Since
\(w\)'s state has been recorded, \(A\) records its own state 
before executing event 3. The state of
\(A\) that is recorded is shown by a black dot.

Event 1 is in the past with respect to this recording, and so it is
colored black.

<figure>
    <img src="AgentTimeline_10.jpg" alt="Fig1" style="width:80%">
    <figcaption>Fig.3: Example - Event 3</figcaption>
</figure>


<p>
In event 4, agent \(B\) references variables \(v\) and \(w\). Since
\(w\)'s state has been recorded, \(B\) records its own state and
\(v\)'s state
before executing event 4. The states of
\(B\) and \(w\) that are recorded is shown by black dots.

<figure>
    <img src="AgentTimeline_11.jpg" alt="Fig1" style="width:80%">
    <figcaption>Fig.4: Example - Event 4</figcaption>
</figure>

You can see that the the black dots form a 
of a consistent cut. Thus the recorded states of agents and shared
variables correspond to the global state along a consistent cut.


<h3 class="w3-text-teal">Proof of Correctness</h3>
Next we prove that the algorithm is correct. We need to prove that the
set of agent and shared-variable recorded states --- i.e., the set of
black dots --- forms a consistent cut. Equivalently, we need
to prove that every edge from the future is to the future (with respect to
the cut).

<p>
Consider an edge from event \(e\) to event \(e'\). If \(e\) is in the
future then the states of the agent executing the event and
all variables referenced in the event have been recorded at \(e\).
There is an edge from \(e\) to \(e'\) only if the agent executing the
events are the same or there is a shared variable referenced in both
events. If the same agent executes \(e\) and \(e'\), then from rule 1
it follows that if 
the state of the agent has been recorded at \(e\) then it has also 
been recorded at \(e'\); and therefore \(e'\) is in the future. The
same argument holds for the shared variables referenced in the event.



  <footer id="myFooter">

    <div class="w3-container w3-theme-l1">
      <h4>An Introduction to Distributed Algorithms by K. Mani Chandy,
      <br>
      Simon Ramo Professor, Emeritus, California Institute of Technology</h4>
    </div>
  </footer>


      


<!-- END MAIN -->
</div>

<script>
// Get the Sidebar
var mySidebar = document.getElementById("mySidebar");

// Get the DIV with overlay effect
var overlayBg = document.getElementById("myOverlay");

// Toggle between showing and hiding the sidebar, and add overlay effect
function w3_open() {
  if (mySidebar.style.display === 'block') {
    mySidebar.style.display = 'none';
    overlayBg.style.display = "none";
  } else {
    mySidebar.style.display = 'block';
    overlayBg.style.display = "block";
  }
}

// Close the sidebar with the close button
function w3_close() {
  mySidebar.style.display = "none";
  overlayBg.style.display = "none";
}
</script>

</body>
</html>

