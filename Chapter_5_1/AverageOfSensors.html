<!DOCTYPE html>
<html lang="en">
<title>AverageOfSensors</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
html,body,h1,h2,h3,h4,h5,h6 {font-family: "Roboto", sans-serif;}
.w3-sidebar {
  z-index: 3;
  width: 250px;
  top: 43px;
  bottom: 0;
  height: inherit;
}
/* Thick blue border */
hr.new4 {
  border: 5px solid blue;
}
/* Thin blue border */
hr.new2 {
  border: 2px solid blue;
}

</style>

<body>

<!-- Navbar -->
<div class="w3-top">
  <div class="w3-bar w3-theme w3-top w3-left-align w3-large">
    <a class="w3-bar-item w3-button w3-right w3-hide-large w3-hover-white w3-large w3-theme-l1" href="javascript:void(0)" onclick="w3_open()"><i class="fa fa-bars"></i></a>
    <a href="../index.html" class="w3-bar-item w3-button w3-hide-small
    w3-hover-white">About the Course</a>
    <a href="../table_of_contents.html" class="w3-bar-item w3-button w3-hide-small
    w3-hover-white">Table of Contents</a>
    <a href="../cross_reference.html" class="w3-bar-item w3-button w3-hide-small w3-hover-white">Index</a>
  </div>
  </div>
 

<!-- Sidebar -->
<nav class="w3-sidebar w3-bar-block w3-collapse w3-large w3-theme-l5 w3-animate-left" id="mySidebar">
  <a href="javascript:void(0)" onclick="w3_close()" class="w3-right w3-xlarge w3-padding-large w3-hover-black w3-hide-large" title="Close Menu">
    <i class="fa fa-remove"></i>
  </a>
  
  <h3 class="w3-bar-item"><b>An Introduction to Distributed
  Algorithms</h3>

  <h3 class="w3-bar-item"><b>Section: Examples of Concurrent Systems</h3>

  <a class="w3-bar-item w3-button w3-hover-black"
  href="AverageOfSensors.html">Example: Average of Sensor Readings</a>
  
  <a class="w3-bar-item w3-button w3-hover-black"
  href="AverageOfSensorsExample.html">Examples</a>
  
  <a class="w3-bar-item w3-button w3-hover-black"
  href="AverageOfSensorsSelfTest.html">Self Tests</a>

  <a class="w3-bar-item w3-button w3-hover-black"
  href="AverageOfSensorsExercises.html">Exercises</a>

  <a class="w3-bar-item w3-button w3-hover-black"
  href="AverageOfSensorsExplorations.html">Explorations</a>
  
  <a class="w3-bar-item w3-button w3-hover-black"
  href="../Chapter_5_2/FLightFormation.html">Next: Flight Formation</a>
  
  <a class="w3-bar-item w3-button w3-hover-black"
  href="../Chapter_5/EarliestMeetingTime.html">Previous:
  Example: Earliest Meeting Time</a>

  
</nav>

<!-- Overlay effect when opening sidebar on small screens -->
<div class="w3-overlay w3-hide-large" onclick="w3_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>

<!-- Main content: shift it to the right by 250 pixels when the sidebar is visible -->
<div class="w3-main" style="margin-left:250px">
  
<script id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
  
  <div class="w3-row w3-padding-64">
  <div class="w3-twothird w3-container">
    
    <h1 class="w3-text-teal">Example: Average of Sensor Values</h1>

    <p>
    This module describes the proof of a simple concurrent system in
    which a collection of agents, each with access to two sensor
    readings, computes the average reading across a set of sensors.
    </p>

    <h2 class="w3-text-teal">Problem Description</h2>
    
    <p>
    We are given a connected undirected graph in which each vertex represents a
    sensor and each edge represents an agent. Sensor \(j\) has a
    value \(t_{j}\) which may initially be a reading of temperature or
    some other attribute. There is an agent \(a_{i, j}\) associated with edge \(i,
    j\). (Because the graph is undirected, \(a_{i, j}\) and \(a_{j,
    i}\) are the same agent.) Agent \(a_{i, j}\) has a single action
    which sets \(t_{i}\) and \(t_{j}\) to their average.
    </p>

    <p>Action \(a_{i, j}\)</p>
    <p>
    
    \(
    \forall \; \textrm{edges} \; (i, j), \forall \; T_{i}, T_{j}: \quad
    \{t_{i}, t_{j} = T_{i}, T_{j}\}
    \; a_{i, j} \;
    \{t_{i} = t_{j} = (T_{i} + T_{j})/2.0\}
    \)
    </p>

    <p>
    Because \(t_{j}\), all \(j\) are real values, the computation may
    not terminate as it gets increasingly closer to the goal but never
    reaches it. So, we modify the action \(a_{i,j}\) so that it leaves
    the state unchanged when \(t_{i}\) and \(t_{j}\) are sufficiently close.
    </p>

    <p>
    The post condition for the modified action is:
    </p>

    <p>
    \(
    \begin{eqnarray}
    |T_{i} - T_{j}| < \epsilon \quad &\Rightarrow & \quad (t_{i} = T_{i}) \wedge
    (t_{j} = T_{j}) \\
    |T_{i} - T_{j}| \geq \epsilon \quad &\Rightarrow & \quad (t_{i} = t_{j} = (T_{i} +
    T_{j})/2.0)
    \end{eqnarray}
    \)
    </p>

    <h4 class="w3-text-teal">Terminal States</h4>
    Let \(t_{j}^{0}\) be the initial value of \(t_{j}\) for all
    \(j\). We define a predicate \(goal\) which holds for terminal, or
    goal, states of the computation as follows: \(goal(t)\) holds
exactly when the following two conditions hold:
</p>
    <ol>
      <li>
      <p>
      \(
      \sum_{j} t_{j}^{0} = \sum_{j} t_{j}
      \)
      </p>
      <p>
      We want the sum of the \(t\) values at termination to be equal to the
    sum of their initial values so that the average of
      the values at termination is equal to the initial average.
      </p>
      </li>

      <li>
      <p>
      \(t_{i}\) and \(t_{j}\) are sufficiently close for all edges
      \(i,j\):
      </p>
      <p>
      \(
      \forall \; \textrm{edges} \; (i, j): \; |t_{i} - t_{j}| <
      \epsilon
      \)
      </p>
      </li>
</ol>
</p>

<h4 class="w3-text-teal">Specification</h4>
<p>
Let \(t\) be a tuple whose elements are \(t_{j}\), all \(j\). The
specification is:
</p>
<p>
\(
(t = t^{0}) \leadsto goal(t)
\)
</p>

<h2 class="w3-text-teal">Proof of Correctness</h2>
  <p>
  Next, we give the structure of the proof. The details are found in
  the solution to an exercise.
</p>

<p>
We define a variant function \(f\) where
</p>
<p>
\(
f(t) = \sum_{j} t_{j}^{2}
\)
</p>
<p>
\(f(t)\) is bounded below by \(0\) since it is the sum of squares.
</p>

<p>
The decrease in \(f(t)\) caused by an action in which \(t_{i} =
T_{i}\) and \(t_{j} = T_{j}\) before the action and
\(t_{i} = t_{j} = (T_{i} + T_{j})/2.0\) after the action is
\(|T_{j} - T_{i}|^{2}\).
</p>
<p>
Let \(\delta = \epsilon^{2}\). Then it is easy to see that every
action that changes \(t\) decreases \(f(t)\) by at least \(\delta\).
</p>

<p>
Let \(avg(X)\) be the average of the elements of \(X\).
</p>

  <hr class="new2">
<p class="w3-text-teal">Safety</p>
<p>
<i>Part 1</i>: 
Show that every action, \(a_{i,j}\), leaves the average unchanged:
</p>
<p>
\(
(t = T) \quad \rightarrow \quad (avg(t) = avg(T))
\)
</p>

<p>
<i>Part 2</i>: 
  Show that every action, \(a_{i,j}\), either leaves \(t\) unchanged or decreases
  \(f(t)\) by at least  \(\delta\):
  <p>
  \(
(t = T) \quad \rightarrow \quad ((t = T) \vee (f(t) \leq f(T) - \delta))
  \)
</p>
<p>
The proofs for both parts are straightforward.
</p>

  <hr class="new2">

  <p class="w3-text-teal">Progress</p>
  <p>
  Show that \(\neg goal(t)\) is transitory - i.e., \(t\) changes - because
  execution of a fair action, \(a_{i,j}\), changes \(t\). This is
straightforward.
</p>
<p>
  From the safety property changes to \(t\) decrease \(t\) by at least \(\delta\).
  Therefore \(f(t)\) decreases by at least \(\delta\) at each step  while
\(\neg goal(t)\) holds. But \(f(t)\) is bounded below and 
the result follows.
  </p>

  <hr class="new2">



<!------------------------------------------------->
<h2 class="w3-text-teal">Summary</h2>
<p>
This module gives an example of a concurrent system and its proof of
correctness. 
</p>


  <footer id="myFooter">

    <div class="w3-container w3-theme-l1">
      <h4>An Introduction to Distributed Algorithms by K. Mani Chandy,
      <br>
      Simon Ramo Professor, Emeritus, California Institute of Technology</h4>
    </div>
  </footer>


<!-- END MAIN -->
</div>

<script>
// Get the Sidebar
var mySidebar = document.getElementById("mySidebar");

// Get the DIV with overlay effect
var overlayBg = document.getElementById("myOverlay");

// Toggle between showing and hiding the sidebar, and add overlay effect
function w3_open() {
  if (mySidebar.style.display === 'block') {
    mySidebar.style.display = 'none';
    overlayBg.style.display = "none";
  } else {
    mySidebar.style.display = 'block';
    overlayBg.style.display = "block";
  }
}

// Close the sidebar with the close button
function w3_close() {
  mySidebar.style.display = "none";
  overlayBg.style.display = "none";
}
</script>

</body>
</html>
