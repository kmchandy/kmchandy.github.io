    <!--------------------------------------------------------->
    <h1 class="w3-text-teal">Properties of Timelines</h1><p>

<h3 class="w3-text-teal">Timelines are Acyclic</h3>
Graphs in timeline diagrams are acyclic because all edges in the
    timeline diagram are
    directed from earlier times to later times.
    Pictorially, timeline diagrams are acyclic because all edges are directed
    from left to right.

    <p>
    The vertices in an acyclic graph are a partially ordered set with
    edge directions representing the partial order. We say that a total order of
    vertices is
    consistent with an acyclic graph
    exactly when \(v\) appears
    before \(w\) in the total order if there is an edge from \(v\) to \(w\) in the
    graph.

    <p>
    A timeline diagram consists of an acyclic graph \(G\) and a
    total order \(e_{0}, e_{1}, \ldots\). This order is consistent with
    the graph because all edges in the graph are from events earlier
    in the ordering to events later in the ordering. Pictorially, the
    total order of vertices is consistent with \(G\) exactly when all
    edges are directed from left to right.


    <!------------------------------------------------------------>
    <h2 class="w3-text-teal">Permuting events in a trajectory</h2>
    
Let \(e_{i}\) be the event
\(s_{i} \stackrel{a_{i}}{\rightarrow} s_{i+1}\) in a
 system trajectory
\(
s_{0} \stackrel{a_{0}}{\rightarrow} s_{1}
\stackrel{a_{1}}{\rightarrow}
\ldots \stackrel{a_{m-1}}{\rightarrow} s_{m}
    \).
    Let \(TD\) be the timeline diagram of this trajectory, and \(G\)
    be the graph of this timeline. 
    <p>
    Consider any total order of vertices consistent with \(G\) and let \(TD'\) be the timeline
    diagram with this order. The graphs of both timeline
    diagrams \(TD\) and \(TD'\) are identical; the only difference is the order in which
    vertices appear as we go from left to right. All edges in both
    \(TD\) and \(TD'\)
    are directed from left to right because the order in which
    vertices appear is consistent with the graph \(G\). 



    
    We begin with a simple example that illustrates all the ideas that
    are used in taking global snapshots, termination detection, deadlock
    detection, and many other algorithms.

    <h3 style="color:red;">Example</h3>
    
    Consider the timeline for a trajectory,
    \(
s_{0} \stackrel{a_{0}}{\rightarrow} s_{1}
\stackrel{a_{1}}{\rightarrow} s_{2}
    \)
    <p>
    The timeline is specified by the sequence of events \([e_{0},
    e_{1}]\) where \(e_{0}\) is the event \(s_{0}
    \stackrel{a_{0}}{\rightarrow} s_{1}\) and \(e_{1}\) is the event \(s_{1}
    \stackrel{a_{1}}{\rightarrow} s_{2}\).
    Consider the case where there are no paths from event \(e_{0}\) to
    event \(e_{1}\), or from \(e_{1}\) to \(e_{0}\), in the graph.
    An example of such a timeline is shown below.
    
    <figure>
    <img src="SwitchingEventsOneAndZero_2.jpg" alt="Fig1" style="width:80%">
    <figcaption>Fig.1: Trajectory 1: Timeline with events 0 and 1 in order</figcaption>
    </figure>
    
    <p>
    In the example, agent \(A\) modifies variable \(v\) in event
    \(e_{0}\), and agent \(B\) modifies variable \(w\) in event
    \(e_{1}\). The initial states of \((A, v, B, w)\) are \((A_{0},
    v_{0}, B_{0}, w_{0})\) respectively. After event \(0\), the states
    of \(A\) and \(v\) change to \(A_{1}\) and \(v_{1}\),
    respectively. The states of \(B\) and \(w\) are unchanged by event
    \(0\).

    <p>After event \(1\), the states
    of \(B\) and \(w\) change to \(B_{1}\) and \(w_{1}\),
    respectively. The states of \(A\) and \(v\) are unchanged by event
    \(1\).
    

<p>
    Now consider the timeline for the trajectory
    \(
s_{0} \stackrel{a_{1}}{\rightarrow} s'_{1}
\stackrel{a_{0}}{\rightarrow} s'_{2}
    \)
    in which the order of
    execution of \(a_{0}\) and \(a_{1}\) are switched. Note that this
    trajectory starts at the same initial state \(s_{0}\). The timeline is
    shown in the figure below.
    
    <figure>
    <img src="SwitchingEventsOneAndZero_3.jpg" alt="Fig2" style="width:80%">
    <figcaption>Fig.2: Trajectory 2: Timeline when order of events 0 and 1 are switched</figcaption>
    </figure>

    <p>
In a timeline diagram, with time flowing horizontally from left to
right, an instant in time is represented by a straight vertical
line. The diagram below shows lines representing two instants at times
\(T_{1}\) and \(T_{2}\) for trajectory 1. The global
state, \(s_{1}\), at  time \(T_{1}\) is the tuple of states of agents and shared
variables at \(T_{1}\). In the diagram, the global states at \(T_{1}\)
and \(T_{2}\)
are the tuples of labels of edges intersected by the line
representing \(T_{1}\) and \(T_{2}\). 
    
    <figure>
    <img src="SwitchingEventsOneAndZero_4.jpg" alt="Fig2" style="width:80%">
    <figcaption>Fig.3: Global states at instants in time for
    trajectory 1</figcaption>
    </figure>

The next figure shows the diagram for trajectory 2. The diagram shows
the  global states
\(s'_{1}\) at time \(T'_{1}\).
    
    <figure>
    <img src="SwitchingEventsOneAndZero_5.jpg" alt="Fig2" style="width:80%">
    <figcaption>Fig.4: Global states at instants in time for
    trajectory 2</figcaption>
    </figure>
    
<p>
The sequence of states for trajectory 1 is:
<p>
\(
s_{0} = (A_{0}, v_{0}, B_{0}, w_{0})
\)
<br>
\(
s_{1} = (A_{1}, v_{1}, B_{0}, w_{0})
\)
<br>
\(\
s_{2} = (A_{1}, v_{1}, B_{1}, w_{1})
\)
<p>
and for trajectory 2:
<p>
\(
s'_{0} = (A_{0}, v_{0}, B_{0}, w_{0})
\)
<br>
\(
s'_{1} = (A_{0}, v_{0}, B_{1}, w_{1})
\)
<br>
\(
s'_{2} = (A_{1}, v_{1}, B_{1}, w_{1})
\)
</p>


 

    
    It's easy to verify that the <i>graphs</i> for both trajectories ---
see figures 1 and 2 --- are
identical.
The timelines are different because vertices of
the same graph appear in different orders in the timelines: 
     \(e_{0}\) before \(e_{1}\) in  the first timeline and \(e_{0}\)
after \(e_{1}\) in the second. Graphs do not specify orderings among
vertices, but timelines do.

<p>
We see that \(s_{2} = s'_{2}\). The system states are the same after
both events 0 and 1, regardless of which event occurred first.


<h3 class="w3-text-teal">The past and future</h3>
    
    <figure>
    <img src="SwitchingEventsOneAndZero_6.jpg" alt="Fig2" style="width:80%">
    <figcaption>Fig.5: Past and future at a point \(T_{1}\) in trajectory 1</figcaption>
    </figure>

The events that occur before \(T_{1}\) are called
<i>past</i> events at \(T_{1}\), and the events that occur after
\(T_{1}\) are called <i>future</i> events at \(T_{1}\). In the diagram, event \(0\)
is in the past and event \(1\) is in the future at \(T_{1}\).

<p>
Let \(T'_{1}\) and \(T'_{2}\) be instants in time for the trajectory
shown in figure 2. These times are shown as vertical lines in the
figure below. In this diagram, event \(0\) is in the future at
\(T'_{1}\) and event  \(1\) is in the past.

    <figure>
    <img src="SwitchingEventsOneAndZero_7.jpg" alt="Fig2" style="width:80%">
    <figcaption>Fig.6: Past and future at a point \(T'_{1}\)in trajectory 2</figcaption>
    </figure>

<h3 class="w3-text-teal">Cuts</h3>
What is a pictorial representation of the vertical line \(T'_{1}\) in
trajectory 2 when drawn on the diagram for trajectory 1?
The past at \(T'_{1}\) in trajectory 2 includes event \(1\),
while the future includes event \(0\). A line that separates the past
and future at \(T'_{1}\) in trajectory 2, when drawn on the
diagram of trajectory 1, is curvilinear.

    <figure>
    <img src="SwitchingEventsOneAndZero_8.jpg" alt="Fig2" style="width:80%">
    <figcaption>Fig.7: Past and future at a point in trajectory 2</figcaption>
    </figure>

<p>
A cut is a set of points, one point for each timeline. It is shown as
small purple circles figures 7 and 8. The purple line connecting the
purple circles is a pictorial rendering of the cut.

<p>
Event \(1\) is past at \(T'_{1}\) in trajectory 2, see figure 6. This past event is
colored black in figure 8; it is in the past with respect to the cut \(T'_{1}\)
across trajectory 1. Likewise,
event \(0\) is in the future at \(T'_{1}\) in trajectory 2. This future event is
colored white in figure 8; it is in the future with respect to the cut \(T'_{1}\)
across trajectory 1.
The cut across trajectory 1 in figure 8 separates past from future at
the instant \(T'_{1}\) in trajectory 2.
The curvilinear cut at \(T'_{1}\) across trajectory 1 represents the
vertical cut at \(T'_{1}\) across trajectory 2.

    <figure>
    <img src="SwitchingEventsOneAndZero_9.jpg" alt="Fig2" style="width:80%">
    <figcaption>Fig.8: Timeline when order of events 0 and 1 are switched</figcaption>
    </figure>

<p>
Next,
we give a theorem that tells us what permutations of events in a
trajectory are also trajectories.






<h2 class="w3-text-teal">Theorem: Permuting Events in a Trajectory</h2>
Let \(G\) be the timeline graph of a trajectory \(T\) which starts in a
state \(s\) and ends in a state \(s'\) and which has an event sequence
\([e_{0}, \ldots, e_{m-1}]\).
Let \(E\) be any permutation of \([e_{0}, \ldots, e_{m-1}]\) that
satisfies the following condition:
<p>
<i>
\(e_{i}\) appears before  \(e_{j}\) in \(E\) if edge
\((e_{i}, e_{j})\) exists in \(G\).
</i>
<p>
There exists a trajectory with event sequence \(E\), that starts
in state \(s\) and ends in state \(s'\).

<p class="w3-text-teal">Proof</p>
Let \(G'\) be the timeline graph of a trajectory \(T'\) which starts in a
state \(s\) and which has an event sequence
\([e'_{0}, \ldots, e'_{m-1}]\) that is a permutation of the event
sequence for \(T\) and that satisfies the specified condition. We will
show by induction on \(j\) that the subgraph of \(G'\) consisting of
events \([e'_{0}, \ldots, e'_{j}]\), and vertices between them, is
also a subgraph of \(G\).

<p>
The base case is the empty sequence represented by the initial
state \(s_{0}\) and event \(e_{-1}\) which is common to both \(G\) and
\(G'\).

<p>
Assume that the theorem holds for some \(j\). From the specified
condition, all paths to \(e'_{j+1}\) are in the subgraph of \(G'\)
covering vertices \([e'_{0}, \ldots, e'_{j}]\). From the result in
<a href="../Agents/Agents.html">the module on agents</a> the output of 
\(e'_{i}\), for any \(i\), is a function of \(s_{0}\) and the events with paths to 
\(e'_{i}\). By the induction assumption, these paths are the same in the
subgraphs for \(G\) and \(G'\) that span vertices in \([e'_{0}, \ldots,
e'_{j}]\). Therefore the inputs to \(e'_{j+1}\) are the same in both 
\(G\) and \(G'\). And the result follows.


<!------------------------------------------------->
<h3  class="w3-text-teal">What the theorem is saying pictorially</h3>

<BLOCKQUOTE>
Given a timeline diagram for a trajectory, you can
move events forward or backward in time, <i>provided all edges are
directed forward in time</i>, to create the timeline diagram for another trajectory. 
</BLOCKQUOTE>

Pictorially, you can create a new timeline diagram by moving events towards
the left or right, horizontally along an agent or variable timeline,
provided that all edges are pointed rightwards.

<p>
<h2 style="color:red;">Example</h2>
The next two diagrams show trajectories that have identical events
that occur in different sequences. These two figures are similar to
figures 1 and 2. The diagrams illustrate what the theorem is saying
pictorially. 

<p>
The
trajectories shown in the figures have agents \(A, B, C\) and
variables \(v, w\). The horizontal red lines are timelines for variables
and the blue lines are timelines for agents. The green lines show
the dependence between events that read and write the same variable.

<p>
The figure below shows a timeline graph, \(G\), for a trajectory \(Z\)
with
event sequence \([e_{0}, e_{1}, e_{2 }, e_{3}, e_{4}, e_{5}]\).
The black numbers below the events, in the diagram, give the identity
of the events.

Sequence 
\([e_{1}, e_{0}, e_{2 }, e_{4}, e_{3}, e_{5}]\), also has the
property that if there is an edge \((e_{i}, e_{j})\) in \(G\), then \(e_{i}\) appears
before \(e_{j}\) in this sequence. The red numbers show the positions
of events in the permuted sequence.

<p>
From the theorem, both sequences of events are trajectories, 
starting in the same state, and ending in the same state. And both
trajectories have the same timeline graph. We can get the timeline
graph for the permuted trajectory by moving event 1 to the left of
event 0, and moving event 3 to the left of event 4. These movements
satisfy the constraint that edges point rightwards after the
movements.

<p>
For example, the constraint does not allow event 3 to be moved to the
left of event 2 because then the edge from event 2 to event 3 would
point backward in time (i.e. leftwards).

<figure>
    <img src="SwitchingOrdersExample3_1.jpg" alt="Fig3" style="width:80%">
    <figcaption>Fig.9: Example - Permuting events</figcaption>
</figure>

The following figure shows the same graph with events appearing from
left to right in the order of the sequence
\([e_{1}, e_{0}, e_{2 }, e_{4}, e_{3}, e_{5}]\).
<figure>
    <img src="SwitchingOrdersExample3_2.jpg" alt="Fig3" style="width:80%">
    <figcaption>Fig.10: Example: Timeline with events permuted</figcaption>
</figure>

The following two figures illustrate cuts in the timeline diagram of
figure 9. 

<figure>
    <img src="AgentTimelineSlide07.jpg" alt="Fig4" style="width:80%">
    <figcaption>Fig.11: Example of a Cut</figcaption>
</figure>

<figure>
    <img src="AgentTimelineSlide14.jpg" alt="Fig5" style="width:80%">
    <figcaption>Fig.12: Example of a Cut</figcaption>
</figure>

Past events in the cut are colored black, and future events are
colored white.

<h3 class="w3-text-teal">Consistent Cuts in Timelines</h3>
A  <i>consistent cut</i> of the timeline graph is a cut such that 
all edges to past events are from past events.

<p>
A consistent cut may have edges from the past to the future;
however, it has no edges from the future to the past.

Figure 11 shows a consistent cut in a timeline graph.
Figure 12 shows a cut that is inconsistent because it has an edge from the
future to the past.


<p>
Pictorially, a cut is consistent if all green edges that cross the cut
are from the past to the future. A cut is inconsistent if there is
a green edge that crosses the boundary from the future to the
past. All vertical cuts are consistent.

<p>
We saw that the curvilinear cut \(T'_{1}\) of
trajectory 1, shown in figure 7, represents the straight line cut
\(T'_{1}\) of trajectory 2, shown in figure 6. In general:
<BLOCKQUOTE>
<i>Every consistent curvilinear cut in a timeline represents a vertical cut in
another timeline.</i>
</BLOCKQUOTE>

<h4 class="w3-text-teal">Global states, snapshots and time-ordering of
cuts</h4>
<p>
<i>The global state associated with a cut</i> is given by the state of each
agent, and each shared variable, at the points at which their
timelines are cut.

<p>
<i>A global snapshot</i> is the global state associated with a consistent cut.

<p>
A cut \(C\) is said to be <i>earlier than</i> a  cut \(C'\) exactly
when the past of \(C'\) is a strict superset of the past of \(C\).
Equivalently \(C\) is earlier than \(C'\) when the future of 
\(C\) is a strict superset of the future of \(C'\).

<h2 class="w3-text-teal">The Consistent-Cut Theorem</h2>
Let \(c_{0}, c_{1}, \ldots\) be a sequence of consistent cuts
of a trajectory \(Z\) where
\(c_{i}\) is earlier than \(c_{i+1}\), all \(i\). There exists a
trajectory \(Z'\) that visits the global states corresponding to cuts
\(c_{0}, c_{1}, \ldots, \) in sequence.


<p class="w3-text-teal">Proof</p>
Frrom the <i>theorem: Permuting events in
a trajectory</i> it follows that there exists a trajectory \(Z'\) in
which all the cuts \(c_{0}, c_{1}, \ldots, \) correspond to instants
in time, with \(c_{i}\) appearing earlier than \(c_{i+1}\), all \(i\).

<p>
The pictorial idea of the proof is shown in the figure below.
<figure>
    <img src="AgentTimelineSlide15.jpg" alt="Fig15" style="width:80%">
    <figcaption>Fig.13: Curvilinear cut in one trajectory is a
vertical cut in another</figcaption>
</figure>