<!--------------------------------------------------------->
    <h2 class="w3-text-teal">Timelines</h2>
<!--------------------------------------------------------->
A timeline diagram depicts the evolution of a <i>single</i>
trajectory of a system over time.  A state transition of an agent
during this trajectory is called an <i>event</i> at that agent.

A timeline diagram is a labeled directed graph which is laid out in a
specific way.  Vertices of the graph represent events.  The graph has
an edge directed from an event at an agent to the next event at that
agent; the edge is labeled with the state of the agent between the two
events. 

<p>
The horizontal axis represents time.  Each agent has its own timeline
represented by a horizontal line with all events
of an agent on the same line.

<p>
A message \(m\) sent by an agent \(A\) at an event \(e\) and received
by an agent \(B\) at event \(e'\) is represented by an edge directed from
\(e\) to \(e'\), and this edge is labeled \(m\).


<h4 style="color:red;">Example</h4>
<figure>
    <img src="Timelines/Timelines.001.jpeg" alt="Fig1" style="width:100%">
    <figcaption>Fig.1: A Timeline Diagram</figcaption>
</figure>
This example shows a timeline diagram with two agents, \(A\) and
\(B\).  The vertices  A0, A1, A2, A3 represent events at agent \(A\);
likewise vertices B0, B1 B2,represent \(B\)'s events.

<p>
An edge along an agent's timeline is labeled with the state of that
agent at the point. For example, the edge from event A1 to event A2 is
labeled \(S[A1]\) which is agent \(A\)'s state after event A1 and
before event A2.

<p>
Event A1 is an example of an internal event in which an agent changes
state without receiving a message.
Event A2 is an example of an event in which an agent changes
state when it receives a message.

<p>
The diagram shows that
agent \(A\) sends message \(m_{0}\) in event A1 and this message is
received by agent \(B\) in event B1.

<h4 class="w3-text-teal">Channel States in Timeline Diagrams</h4>
The state of a channel \(c\) at time \(T\) is the sequence (in time
order) of messages that are sent along \(c\) before \(T\) and that are
received after \(T\). The state of \(c\) at \(T\) can be obtained from
the timeline diagram as the sequence of labels of edges representing
messages along \(c\) that are cut by the \(T\)-line, the vertical line
at \(T\).

<h4 style="color:red;">Example</h4>
<figure>
    <img src="Timelines/Timelines.002.jpeg" alt="Fig2" style="width:100%">
    <figcaption>Fig.2: Global State from a Timeline Diagram</figcaption>
</figure>
Figure 2 shows 
timeline diagram with agents \(A, B, D\). Agent \(A\) sends messages
\(m_{0}\) along a channel \(x\) and sends \(m_{1}\) along a different
channel \(c\) at event A1.  When agent \(D\) receives \(m_{0}\) at
event D1 it sends message \(r_{0}\) to \(A\) along a channel \(y\).
When agent \(A\) receives \(r_{0}\) at event A2 it sends message
\(m_{2}\) to \(B\) along channel \(c\).  When agent \(B\) receives
message \(m_{1}\) at event B1 it sends message message \(u_{0}\) to
\(A\) along a channel \(v\).

<p>
The state of \(c\) at time \(T\) is the sequence of labels, \([m_{1},
m_{2}]\), of edges representing messages on \(c\) that are cut by the
\(T\)-line.  The state of an agent \(A\) at \(T\) is the label of the
edge on \(A\)'s timeline cut by the \(T\)-line.  So, the global state
of the system at T can be obtained from labels of edges cut by the
\(T\)-line.


<h4 class="w3-text-teal">The Trajectory: Sequence of Global States</h4>
A trajectory is a sequence of <i>global</i> states.
The sequence of global states can be obtained from the timeline diagram
from the labels of edges cut by vertical lines before each event.

<h4 style="color:red;">Example</h4>
<figure>
    <img src="Timelines/Timelines.003.jpeg" alt="Fig3" style="width:100%">
    <figcaption>Fig.3: Global States in the Trajectory</figcaption>
</figure>
The sequence of events in this trajectory is: Initital events (A0, B0, D0)
in any order followed by the sequence A1, D1, A2, B1, A3, B2.

The figure shows vertical lines corresponding to different points in
the timeline diagram before each event.

<h4 class="w3-text-teal">Different Trajectories with Identical Graphs</h4>
Are there different trajectories with identical graphs?
Look at the next figure.

<figure>
    <img src="Timelines/Timelines.005.jpeg" alt="Fig5" style="width:100%">
    <figcaption>Fig.4: A Different Trajectory with Same Graph</figcaption>
</figure>
The trajectory in this diagram is specified by the sequence of events:
Initial events (A0, B0, D0) followed by the sequence A1, D1, B1,
A2, A3, B2.

<p>
The graphs of figures 3 and 4 are the same but the trajectories that
the figures represent are different.  In figure 4 event B1 occurs
before event A2 whereas in figure 3, B1 occurs after A2.  So, there is
a global state after B1 and before A2 in figure 4 that is never
visited in figure 3.
<p>
The <i>local</i> timelines of each agent --- i.e., the horizontal
lines in the diagram --- are identical in both figures; however, an
event B1 on an agent B occurs before an event A2 on a different agent
A, in figure 3, but the events appear in the reverse order in figure
4.
<p>
The following theorem captures the idea illustrated by figures 3 and
4.  

<h3 class="w3-text-teal">Theorem</h3>
Given a timeline diagram Z of a system, let Z' be another timeline
diagram with the same graph as D.  The local trajectory of each agent
is the same in both Z and Z'; however, an event
\(e\) on one agent which appears before an event \(e'\) on a different
agent in Z may appear in the reverse order in Z'.

<p>
A necessary and sufficient conditions for Z' to represent a trajectory
of the same system is that in Z' <i>each message is received only after
it is sent.</i>


<h4 class="w3-text-teal">Proof</h4>
The condition is necessary because there is no system in which a
message is received before it is sent. Next we show that the condition
is sufficient.
<p>
The proof is by induction on the sequence of events in Z'. Assume that
there exists a trajectory consisting of the first \(n\) events of Z'
where the inputs and outputs of each event in Z' are the same as those
of the corresponding events in Z. Let \(e\) be the \(n+1\)-th event in
Z'. By the induction assumption, the inputs to \(e\) are the same in Z
and Z'. Therefore, the outputs of \(e\) in Z' are the same as in Z.


<h4 class="w3-text-teal">Theorem in Terms of Timelines</h4>
Given a timeline diagram Z that represents a trajectory of a
system. Consider a diagram Z' obtained by moving vertices on each
horizontal line in Z to the right or left. Then Z' represents a trajectory
if and only if <i>all edges are directed forwards in time</i>,
i.e. towards the right.


<h3 class="w3-text-teal">Cuts across Timelines</h3>
A consistent cut of a timeline diagram is a partition of the events in
the diagram into two subsets called <i>past</i> and <i>future</i>, and
in which there is no message from a <i>future</i> event
to a <i>past</i> event.

<p>Equivalently, a consistent cut is a partition in which all
messages <i>from future</i> events are <i>to future</i> events.
This is also
equivalent to: all edges <i>to past</i> events are <i>from past</i>
events.

<p>
An inconsistent cut is a partition of the events into <i>past</i> and
<i>future</i> where there exists a message from a future event
to a past event.
  

<h4 style="color:red;">Example</h4>
The figure below shows cuts across two timeline diagrams
where past events are colored black and future events are green.
<figure>
    <img src="Timelines/Timelines.009.jpeg" alt="Fig4" style="width:100%">
    <figcaption>Fig.5: Cuts of Timelines</figcaption>
</figure>

The cuts in figure 5 are consistent because there is no edge from
green to black.

<h3 class="w3-text-teal">Theorem about Consistent Cuts</h3>
For any cut, \([past, future]\), of a timeline diagram of a trajectory
\(\tau\) there exists a trajectory \(\tau'\) with the same events as
\(\tau\) where all past events occur before all future events in
\(\tau'\), if and only if the cut is consistent.
<p>
The proof follows directly from the theorem on trajectories.

<p style="color:red;">Example</p>
The cut in the diagram on the top of figure 5 is consistent.
Therefore, there exists a timeline diagram, shown at the bottom of the
figure, in which all past events occur before all
future events.
<p>
The straight vertical purple line in the lower diagram represents an instant
in time: it separates past (events before that instant) from future
(events after that instant). The curvy purple line in the upper
diagram corresponds to the straight line in the lower diagram.


<h4 class="w3-text-teal">Takeaway</h4>
Timelines are a familiar concept, helpful in
understanding distributed systems and other multi-agent
systems.