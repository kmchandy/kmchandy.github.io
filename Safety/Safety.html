<!DOCTYPE html>
<html lang="en">
<title>Safety</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
html,body,h1,h2,h3,h4,h5,h6 {font-family: "Roboto", sans-serif;}
.w3-sidebar {
  z-index: 3;
  width: 250px;
  top: 43px;
  bottom: 0;
  height: inherit;
}
/* Thick blue border */
hr.new4 {
  border: 5px solid blue;
}
/* Thick blue border */
hr.new2 {
  border: 2px solid blue;
}

</style>

<body>

<!-- Navbar -->
<div class="w3-top">
  <div class="w3-bar w3-theme w3-top w3-left-align w3-large">
    <a class="w3-bar-item w3-button w3-right w3-hide-large w3-hover-white w3-large w3-theme-l1" href="javascript:void(0)" onclick="w3_open()"><i class="fa fa-bars"></i></a>
    <a href="../index.html" class="w3-bar-item w3-button w3-hide-small
    w3-hover-white">About the Course</a>
    <a href="../table_of_contents.html" class="w3-bar-item w3-button w3-hide-small
    w3-hover-white">Table of Contents</a>
    <a href="../cross_reference.html" class="w3-bar-item w3-button w3-hide-small w3-hover-white">Index</a>
  </div>
  </div>
 

<!-- Sidebar -->
<nav class="w3-sidebar w3-bar-block w3-collapse w3-large w3-theme-l5 w3-animate-left" id="mySidebar">
  <a href="javascript:void(0)" onclick="w3_close()" class="w3-right w3-xlarge w3-padding-large w3-hover-black w3-hide-large" title="Close Menu">
    <i class="fa fa-remove"></i>
  </a>
  
  <h3 class="w3-bar-item"><b>An Introduction to Distributed
  Algorithms</h3>

  <a class="w3-bar-item w3-button w3-hover-black"
  href="Safety.html">Review of Safety in Loops</a>
  
  <a class="w3-bar-item w3-button w3-hover-black"
  href="SafetyExample.html">Examples</a>
  
  <a class="w3-bar-item w3-button w3-hover-black"
  href="SafetySelfTest.html">Self Tests</a>

  <a class="w3-bar-item w3-button w3-hover-black"
  href="SafetyExercises.html">Exercises</a>

  <a class="w3-bar-item w3-button w3-hover-black"
  href="SafetyExplorations.html">Explorations</a>

  <a class="w3-bar-item w3-button w3-hover-black"
  href="../LoopTermination/LoopTermination.html">Next: Loop Termination</a> 
  
  <a class="w3-bar-item w3-button w3-hover-black"
  href="../HoareTriples/HoareTriples.html">Previous: Hoare Triples</a> 
  
</nav>

<!-- Overlay effect when opening sidebar on small screens -->
<div class="w3-overlay w3-hide-large" onclick="w3_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>

<!-- Main content: shift it to the right by 250 pixels when the sidebar is visible -->
<div class="w3-main" style="margin-left:250px">
  
<script id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
  
  <div class="w3-row w3-padding-64">
  <div class="w3-twothird w3-container">
    
    <h1 class="w3-text-teal">Review of Safety in Loops</h1>

    <p>
    This module reviews the representation of a state transition
    system in terms of <a
    href="https://en.wikipedia.org/wiki/Directed_graph">
    directed graphs</a>, and reviews the use of
    <a href="https://en.wikipedia.org/wiki/Loop_invariant">loop
    invariants</a>.
    </p>

    <!---------------------------------------------------------->
    <h2 class="w3-text-teal">Representing a System by a Graph</h2>
  We represent the states and state transitions of a system by a
  <a href="https://en.wikipedia.org/wiki/Directed_graph">directed graph</a>
  in which vertices represent states and edges
  represent  transitions. A system trajectory is a path through the
    graph.
  When we design algorithms we will prove that the system always
    remains in safe states.
    </p>

    <hr class="new4">
    <h4 style="color:blue;">
    
		      Prove that a system is
		      safe by showing that all
		      paths from vertices representing initial states
		      only visit vertices representing safe states.
    </h4>
    <hr class="new4">

    <p>
    Of course, we require that initial states are safe.
    </p>

    

		      <h2 id=Graph2 class="w3-text-teal">Graphs</h2>
		      Let \(G = (V, \rightarrow) \) be a <a
		      href="https://en.wikipedia.org/wiki/Directed_graph">
		      <b>directed graph </b> </a> where \(V\) is the
		      set of vertices and \(\rightarrow \) is a binary
		      relation on vertices that specifies the set of
		      edges: 
		      \(v \rightarrow w\) indicates that there
		      is an edge from vertex \(v\) to vertex \(w\) in
		      the graph.
      </p>

      <a name="Example"></a>
    <h3 class="w3-text-teal">Example</h3>
    
<figure>
  <img src="GraphExample.jpg" alt="Fig1" style="width:80%">>
  <figcaption>Fig.1 - An Example of a Graph</figcaption>
</figure>

		      <p style="color:red;"><b>Examples of vertices</b></p>
\( V = \{0, 1, 2, 3, 4, 5, 6, 7 \} \)

		     

<p style="color:red;"><b>Examples of edges</b></p>
\( 0 \rightarrow 1, \; 0 \rightarrow 2, \;  0 \rightarrow 3, \; 0 \rightarrow 7, \;
\; 1 \rightarrow 7, \; 2 \rightarrow 4,\)
\(2 \rightarrow 5 , \; 3 \rightarrow 5, \;  3 \rightarrow 6, \; 4 \rightarrow 5, \; 5
\rightarrow 4, \; 6 \rightarrow 6, \; 7 \rightarrow 6\)
</p>



		      <h3 class="w3-text-teal">Paths</h3>
		      We use the notation
		      \(\stackrel{*}{\rightarrow}\)
		      to denote the transitive closure of
		      \(\rightarrow\).
		      So, \(v \stackrel{*}{\rightarrow} w\) holds exactly
		      when there exists a path from \(v\) to \(w\) in
the graph. We assume that there exists a path, with zero hops, from each
vertex to itself.
\(\forall v: \; v \rightarrow v \)

<p style="color:red;"><b>Example of paths</b></p>
\(
1 \stackrel{*}{\rightarrow} 1, \; 1 \stackrel{*}{\rightarrow} 7, \;
7 \stackrel{*}{\rightarrow} 7, \; 7 \stackrel{*}{\rightarrow} 6, 
  \; 1 \stackrel{*}{\rightarrow} 6,
  \)


		      <h4 class="w3-text-teal" id=Graph3> Convention</h4>
		      We use upper case \(P, Q, R, X, Y\) to refer to sets of vertices,
		      and lower case \(u, v, w \) to  refer to individual
		      vertices.
		      All formulae containing these terms are
implicitly universally qualified.
</p>

<h3 class="w3-text-teal">Relations between Vertex Sets</h3>

<h4 class="w3-text-teal">\(P \rightarrow Q\)</h4>
We extend the relation \(\rightarrow\)
to sets of vertices as follows.
      \(P \rightarrow Q\) holds exactly when every edge from every vertex in
\(P\) ends at a vertex in \(Q\).
</p>

<p>
\(
\forall v \in P: (v \rightarrow w) \; \Rightarrow \; (w \in Q)
\)
</p>


<figure>
  <img src="ArrowRelation.jpg" alt="Fig2" style="width:80%">>
  <figcaption>Fig.2 - Illustration of \(P \rightarrow Q\)</figcaption>
</figure>
<p>
The diagram illustrates \(P \rightarrow Q\). The diagram shows that
  there may be vertices in \(Q\), such as vertex \(x\), for which
  there is no edge from \(P\).

<p style="color:red;"><b>Example of \(P \rightarrow Q\)</b></p>
\(
\{2, 3\} \rightarrow \{4, 5, 6\}
\)
</p>

<p>
  Explanation: All outgoing edges from vertices \(2\) and \(3\)
terminate at vertices in \(\{4, 5, 6\}\).
</p>

<h4 class="w3-text-teal">\(P \stackrel{*}{\rightarrow} Q\)</h4>
<p>
We extend the relation \(\stackrel{*}{\rightarrow}\)
to sets of vertices in the same way.

\(P \stackrel{*}{\rightarrow} Q\) holds exactly when every path
from every vertex in \(P\) ends at a vertex in \(Q\). 
</p>
<p>
\(
\forall v \in P: (v \stackrel{*}{\rightarrow} w) \; \Rightarrow \; (w \in Q)
\)
</p>

<p>
Therefore
\(P \stackrel{*}{\rightarrow} Q\) holds exactly when all paths from
\(P\) lie entirely in \(Q\), i.e., all vertices on all paths from
\(P\) are in \(Q\).
</p>

<figure>
  <img src="PathRelation.jpg" alt="Fig3" style="width:80%">>
  <figcaption>Fig.3 - Illustration of \(P \stackrel{*}{\rightarrow} Q\)</figcaption>
</figure>

<p>
In the diagram, all the vertices in the outer circle are in
  \(Q\). Both vertices in the green area and the yellow area are in
\(Q\). The vertices in the yellow area are in \(P\).
</p>
<p>
\(P \stackrel{*}{\rightarrow} Q\) holds when all paths from vertices
in \(P\) are in \(Q\). The graph shows that no path from the yellow
area can escape the outer circle.
</p>
<p>
\(P\) lies entirely within \(Q\) because there are zero-length paths
from each vertex in \(P\) back to itself (and so \(P
\stackrel{*}{\rightarrow} P\)) and these paths must lie
inside \(Q\).
</p>

<p>
There may be a vertex \(w\) in \(Q\)
which has an edge to a vertex outside \(Q\). Then there can be no
path to \(w\) from \(P\) because, in that case, there would be a path from \(P\)
to outside \(Q\).
</p>

<p style="color:red;"><b>Example of \(P \stackrel{*}{\rightarrow}
Q\)</b></p>
<p>
\(
\{1, 2\} \rightarrow \{1, 2, 4, 5, 6, 7\}
\)
</p>

<p>
  Explanation: There is a zero-hop path from vertex \(1\) back to
itself, and from vertex \(2\) back to itself. There are paths from
\(2\) to \(4\) and \(5\), and there are paths from \(1\) to \(6\) and
\(7\). There are no paths from \(1\) or \(2\) to \(0\) or \(3\).

<h2 class="w3-text-teal">Safety Proof Obligation</h2>
Let \(init\) be the set of initial vertices and \(safe\) be the set of
safe vertices.
</p>


<hr class="new4">
<h4 style="color:blue;">To prove that a system is safe, we must show
that:
<br>
Equation 1: \(init \stackrel{*}{\rightarrow} safe\)
<h4>
<hr class="new4">


<!----------------------------------------------->
<h2 class="w3-text-teal">Stable</h2>
<b>stable</b> is a function from sets of vertices to the Booleans.
\(stable(P)\) holds exactly when every edge from a vertex in \(P\) is
to a vertex in \(P\).
</p>

<h4 class="w3-text-teal">
\(
stable(P) \; \equiv \; (P \rightarrow P)
\)
</h4>



<figure>
  <img src="StablePaths.jpg" alt="Fig5" style="width:80%">>
  <figcaption>Fig.4 - Paths from a stable set remain in the set</figcaption>
</figure>

<p>
There are no paths from inside a stable set to outside the set because
there are no edges from inside to outside the set. One can think of
paths from a stable set as being trapped inside the set.  There may,
however, be paths from outside a stable set into the set as shown in
the diagram.
</p>

<p>
From the definition, \(stable(P)\) holds exactly when all paths from vertices
in \(P\) are in \(P\). 
</p>
<p class="w3-text-teal">
\(
stable(P) \; \equiv \; (P \stackrel{*}{\rightarrow} P)
\)
</p>

<p style="color:red;"><b>Example of Stable</b></p>
\(
\textit{stable}(\{4, 5\})
\)
<br>
Explanation: Every outgoing edge from vertex \(4\) is to vertex \(5\)
which is in set \(\{4, 5\}\), and every 
outgoing edge from vertex \(5\) is to vertex \(4\)
which is in set \(\{4, 5\}\).
</p>



<!--------------------------------------------------->
<hr class="new4">
<h3 class="w3-text-teal">How to Prove Safety: Invariant</h3>
We prove safety (equation 1: \(init \stackrel{*}{\rightarrow} safe\))
by finding a stable vertex set \(I\) such that:
</p>

<p>
equation 2:
\(
init \subseteq I \subseteq safe
\)
</p>
<hr class="new4">

<figure>
  <img src="Invariant.jpg" alt="Fig6" style="width:80%">>
  <figcaption>Fig.5 - Illustration of Invariant I</figcaption>
</figure>

<p>
Any stable vertex set \(I\) that satisfies equation 2, \(init
\subseteq I \subseteq safe\), is called an <i>invariant</i> of the
graph.  Because \(I\) is stable, all paths from \(I\) remain within
\(I\).  So all paths from \(init\) remain within \(I\).  Therefore,
all paths from \(init\) remain within \(safe\).
</p>
<p>
 We discharge our safety proof obligation by finding an
invariant. 
A system may have many invariants; all we have to do is find any one.
</p>


<!------------------------------------------------->
<h2 class="w3-text-teal">Safety Proofs using Predicates</h2>
We can carry out proofs using sets of vertices or predicates on states
where a state is represented by a vertex. A proof using predicates on
states can be converted to a proof using sets of vertices by treating
each predicate as its extension.

We prove properties of a loop as follows.

<h4 class="w3-text-teal">
\(
P \rightarrow Q \quad \equiv \quad
\forall \; a: \; \{P\} \; a \; \{Q\}
\)
</h4>
where the quantification is taken over all guarded commands, \(a\), of the loop.
So, to prove that \(I\) is an invariant of the loop we show 
<p class="w3-text-teal">
\(
[init \Rightarrow I]
\)
and
\(
[I \rightarrow I]
\)
</p>

<h3 style="color:red;">Example: Sorting</h3>
Let \(I\) be the predicate:
\(X\) is a permutation of \(X^{(0)}\)
where \(X^{(0)}\) is the initial value of \(X\).
<p>
Let us prove that \(I\) is an invariant of the loop.
It is easy to see
that \(I\) holds initially. The proof that \(I\) is stable follows
from the fact that every change to \(X\) permutes \(X\); so, if \(I\)
holds before a change to \(X\) then it holds after the change as well.


  <footer id="myFooter">

    <div class="w3-container w3-theme-l1">
      <h4>An Introduction to Distributed Algorithms by K. Mani Chandy,
      <br>
      Simon Ramo Professor, Emeritus, California Institute of Technology</h4>
    </div>
  </footer>


<!-- END MAIN -->
</div>

<script>
// Get the Sidebar
var mySidebar = document.getElementById("mySidebar");

// Get the DIV with overlay effect
var overlayBg = document.getElementById("myOverlay");

// Toggle between showing and hiding the sidebar, and add overlay effect
function w3_open() {
  if (mySidebar.style.display === 'block') {
    mySidebar.style.display = 'none';
    overlayBg.style.display = "none";
  } else {
    mySidebar.style.display = 'block';
    overlayBg.style.display = "block";
  }
}

// Close the sidebar with the close button
function w3_close() {
  mySidebar.style.display = "none";
  overlayBg.style.display = "none";
}
</script>

</body>
</html>
