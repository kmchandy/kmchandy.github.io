<title>DistributedSystemModels/BasicsEExamples.html</title>

<!------------- Start Heading -------------------------------->
<!DOCTYPE html>

<html lang="en">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet"
href="https://www.w3schools.com/w3css/4/w3.css">

<link rel="stylesheet"
href="https://fonts.googleapis.com/css?family=Roboto">

<link rel="stylesheet"
href="https://www.w3schools.com/lib/w3-theme-blue.css">

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<style>
html,body,h1,h2,h3,h4,h5,h6 {font-family: "Roboto", sans-serif;}
.w3-sidebar {
  z-index: 3;
  width: 250px;
  top: 43px;
  bottom: 0;
  height: inherit;
}
/* Thick blue border */
hr.new2 {
  border: 2px solid blue;
}
/* blue border */
hr.new1 {
  border: 2px solid blue;
}
</style>


<body>


<div class="w3-top">
<div class="w3-bar w3-theme w3-top w3-left-align w3-large">
  
  <a class="w3-bar-item w3-button w3-right w3-hide-large
  w3-hover-white w3-large w3-theme-l1"
  href="javascript:void(0)"
  onclick="w3_open()">
  <i class="fa fa-bars"></i></a>

  <a href="../index.html"
  class="w3-bar-item w3-button w3-hide-small w3-hover-white">
  Distributed Algorithms
  </a>

  <a href="../table_of_contents.html"
  class="w3-bar-item w3-button w3-hide-small w3-hover-white">
  Contents
  </a>

  <a href="../cross_reference.html"
  class="w3-bar-item w3-button w3-hide-small w3-hover-white">
  Index
  </a>
    
  </div>
  </div>
  
  <script id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
  
<div class="w3-row w3-padding-64">
<div class="w3-twothird w3-container">




<!---------------------------------------------------------------->
    <h2 class="w3-text-teal">Basics: Examples</h2>
<!----------------------------------------------------------------->
  Please look at the
  <a href="../CODE_EXAMPLES">Python examples that use the Agent
  class</a> in addition to the examples below.



<!---------------------------------------------------------------->
    <h4 class="w3-text-teal">Basics: Examples Movies</h4>
  <!----------------------------------------------------------------->
  <a href="BasicsExamplesChannels_1.MP4">10-second MP4 movie</a>:
  Messages sent in different
    channels may be delivered out of order.</a>

  <!----------------------------------------------------------------->
  <h4 class="w3-text-teal">Question</h4>
  <!----------------------------------------------------------------->
  A system has agents \(A\), \(B\), and \(C\).

  Initially the channel from \(A\) to \(A\) contains a "wakeup" message.

  All other channels are empty.

  <p>
  Ignore the states of agents for the purposes of this question.

  Is the following scenario possible?
  <ol>
    <li>
    Agent \(A\) receives a wakeup message and sends a message \(m_{1}\) to \(C\) and a
  wakeup to itself.
    </li>
    <li>
    Agent \(A\) receives a wakeup message and sends a message \(m_{2}\) to \(B\).
    </li>
    <li>
    Agent \(B\) receives \(m_{1}\) from \(A\) and sends a message \(m_{3}\) to \(C\).
    </li>
    <li>
    Agent \(C\) receives \(m_{3}\) from \(B\).
    </li>
    <li>
    Agent \(C\) receives \(m_{2}\) from \(A\).
    </li>
  </ol>

  <h5 class="w3-text-teal">Answer</h5>
  Yes, the scenario is possible.

  Messages sent on a channel are delivered in the order sent on that
  channel.

  Messages sent on <i>different</i> channels may not be received in
  the order sent on those channels.

  
  
  <!----------------------------------------------------------------->
  <h4 class="w3-text-teal">Question</h4>
  <!----------------------------------------------------------------->
  A system has agents \(A\) and \(B\).

  Initially the channel from \(A\) to \(A\) contains a "wakeup" message.

  All other channels are empty.

  <p>
  Ignore the states of agents for the purposes of this question.

  Is the following scenario possible?
  <ol>
    <li>
    Agent \(A\) receives a wakeup message and sends a message \(m_{1}\) to \(B\) and a
  wakeup to itself.
    </li>
    <li>
    Agent \(A\) receives a wakeup message and sends a message \(m_{2}\) to \(B\) and a
  wakeup to itself.
    </li>
    <li>
    Agent \(B\) receives  \(m_{2}\) from \(A\)
    </li>
    <li>
    Agent \(B\) receives  \(m_{1}\) from \(A\)
    </li>
 </ol>

  <h5 class="w3-text-teal">Answer</h5>
  No, the scenario is not possible.

  Messages sent on a channel are delivered in the order sent on that
 channel.

 So \(A\) receives \(m_{1}\) from \(B\) before it receives \(m_{2}\)
 from \(B\). 

<a name="Example"></a>
<!----------------------------------------------->
<h4 style="color:red;">Example of a System</h4>
Consider the example given in <a href="Basics.html">the previous
 page.</a>

 Assume that agent <code>neg</code> is the same as agent
 <code>pos</code> except that <code>neg.my_data = [2, 4]</code>

 At some point message 3 is in channel <code>(pos, total)</code> and
 message 2 is in channel <code>(neg, total)</code>, and these are the only
 messages in these channels.

 There is a wakeup message in channel <code>(pos, pos)</code> and in
 channel <code>(neg, neg)</code>.

 <p>
 See Figure Agents and Channels Example 1.1

 
  
    <figure>
    <img
    src="Basics_Diagram.001.jpeg"
    alt="Fig1" style="width:100%"> 
    <figcaption>Figure Agents and Channels Example 1.1</figcaption>
</figure>

 <h5 class="w3-text-teal">Question</h5>
 What changes occur if agent <code>total</code> receives the message
 from <code>pos</code> and this is the first message that
 <code>total</code> receives?

 <h5 class="w3-text-teal">Answer</h5>
 The message 3 on channel <code>(pos, total)</code> is removed from
 the channel.
 Agent <code>total</code>'s variable <code>sum</code> becomes 3 and
 channel <code>(total, X)</code> contains message 3.

 <p>
 See Figure Agents and Channels Example 1.2

 
    <figure>
    <img
    src="Basics_Diagram.002.jpeg"
    alt="Fig2" style="width:100%"> 
    <figcaption>Figure Agents and Channels Example 1.2</figcaption>
</figure>

 
<h5 class="w3-text-teal">Question</h5>
 Same initial state as in the previous question.

 What changes occur if agent <code>total</code> receives the message
 from <code>neg</code> and this is the first message that
 <code>total</code> receives?

 <h5 class="w3-text-teal">Answer</h5>
 The message 2 on channel <code>(neg, total)</code> is removed from
 the channel.
 Agent <code>total</code>'s variable <code>sum</code> becomes 0 and
 channel <code>(total, X)</code> contains message 0.


 <p>
 See Figure Agents and Channels Example 1.3

 
    <figure>
    <img
    src="Basics_Diagram.003.jpeg"
    alt="Fig2" style="width:100%"> 
    <figcaption>Figure Agents and Channels Example 1.3</figcaption>
</figure>


 <h5 class="w3-text-teal">Question</h5>
 Same starting state as in the previous two questions.
 
 What changes occur if agent <code>total</code> receives the message
 from <code>pos</code> and then from <code>neg</code>?

 <h5 class="w3-text-teal">Answer</h5>
 After agent <code>total</code> receives the message
 from <code>pos</code> and then from <code>neg</code> the channels
 from <code>pos</code> and <code>neg</code> to <code>total</code> are
 empty, and the channel from <code>total</code> to <code>X</code> contains message 3
 followed by message 1, and agent <code>total</code>'s 
 variable <code>sum</code> is 1. 


 <p>
 See Figure Agents and Channels Example 1.4

 
    <figure>
    <img
    src="Basics_Diagram.004.jpeg"
    alt="Fig4" style="width:100%"> 
    <figcaption>Figure Agents and Channels Example 1.4</figcaption>
</figure>
 
 <h5 class="w3-text-teal">Question</h5>
 What changes occur if agent <code>total</code> receives its first message
 from <code>neg</code> and its second from <code>pos</code>?

 <h5 class="w3-text-teal">Answer</h5>
 After agent <code>total</code> receives the message
 from <code>neg</code> and then from <code>pos</code> the channels
 from <code>pos</code> and <code>neg</code> to <code>total</code> are
 empty, and the channel from <code>total</code> to <code>X</code> contains message 0
 followed by message 3, and agent <code>total</code>'s 
 variable, <code>sum</code>, is 3. 


 <p>
 See Figure Agents and Channels Example 1.5

 
    <figure>
    <img
    src="Basics_Diagram.008.jpeg"
    alt="Fig5" style="width:100%"> 
    <figcaption>Figure Agents and Channels Example 1.5</figcaption>
</figure>

<h5 class="w3-text-teal">Question</h5>
Consider a sequence of state changes that ends in a state in which all
agents are waiting and all channels are empty.
Agent <code>X</code> prints the messages that it receives. What does
<code>X</code> print during this sequence of state changes?

<h5 class="w3-text-teal">Answer</h5>

<code>X</code> may print any of the following:
<ol>
  <li>
  3, 8, 6, 2. <p> If <code>total</code> receives 3, 5 from
  <code>pos</code> and then receives 2, 4 from <code>neg</code>.
  </li>
  <li>
  3, 1, 6, 2. <p> If <code>total</code> receives 3 from
  <code>pos</code>, then 2 from <code>neg</code>, then 5 from
  <code>pos</code>, then 4 from <code>neg</code>
  </li>
  <li>
  3, 1, 0, 5.<p> If <code>total</code> receives 3 from
  <code>pos</code>, then 2 from <code>neg</code>,
  then 4 from <code>neg</code>,
  then 5 from <code>pos</code>.
  </li>
  <li>
  0, 3, 8, 4. <p>If <code>total</code> receives
  2 from <code>neg</code>,
  then 3 from <code>pos</code>,
  then 5 from <code>pos</code>,
  then 4 from <code>neg</code>.
  </li>
  <li>
  0, 3, 0, 5. <p> If <code>total</code> receives
  2 from <code>neg</code>,
  then 3 from <code>pos</code>,
  then 4 from <code>neg</code>,
  then 5 from <code>pos</code>.
  </li>
  <li>
  0, 0, 3, 8. <p> If <code>total</code> receives
  2 from <code>neg</code>,
  then 4 from <code>neg</code>,
  then 3 from <code>pos</code>,
  then 5 from <code>pos</code>.
  </li>
</ol>
  
  
  
<!--------------------------------------------------------->
    <h2 class="w3-text-teal">Example: Earliest Meeting Time</h2>
<!----------------------------------------------------------------->

<p class="w3-text-red">
  <i>Central Ideas</i>:
  Example illustrating model of a distributed system
  defined by its components (agents, channels), states, state
  transitions, and computations.
  </p>
  
<h3 class="w3-text-teal">Agents</h3>
Three professors (agents) indexed \(0, 1, 2\) want to find the
earliest time that all of them are free so that they can schedule an
exam for a student. Each professor \(j\) has a local variable
  \(T_{j}\) where professor \(j\) can meet at time \(T_{j}\).
  
<p>
Associated with each professor \(j\) is a function \(f_{j}\) where for
any time \(t\), \(f_{j}(t)\) is the earliest time at or after \(t\)
that professor \(j\) can meet. All professors can meet at time \(t\)
exactly when for all \(t\):
<p>
\(
f_{j}(t) = t
\)


<p>
We assume that there exists some time at which all professors can
meet. Otherwise, the student would never get to take the exam! Let the
earliest meeting time for all professors be \(\tau\).

<h3 class="w3-text-teal">Channels</h3>
There is a channel from each professor to each of the other professors
as shown in the diagram. Let \(c_{j,k}\) be the channel from professor
\(j\) to professor \(k\).

    <figure>
    <img src="EarliestMeetingTimeSlides/EarliestMeetingTimeSlides.002.jpeg" alt="Fig1" style="width:100%">
    <figcaption>Fig.1: Graph Representation of the Distributed System</figcaption>
  </figure>

<h4 class="w3-text-teal">Initial State</h4>
Let \(T_{j}^{0}\) be the earliest time that professor \(j\) can meet.
Initially  \(T_{j} = T_{j}^{0}\) and each of the two channels from
professor \(j\) contain a single message \(T_{j}^{0}\).

<h4 class="w3-text-teal">State Transitions</h4>
In this example agents (i.e. professors) have no internal transitions. The
  only transitions are delivery of messages from channels.
  
<h5 class="w3-text-teal">Action on Receiving a Message</h5>
Let \(t\) be the message at the head of a channel \(c\) directed
towards professor \(T_{j}^{0}\). The program executed when a message
<code>t</code> is received is:
<pre>
upon receiving t:
  if t > T[j]:
     T[j] = f(t)
     send T[j] on all outgoing channels of j
  else:
     pass
</pre>

The proof that the algorithm terminates with \(T_{j} = \tau\) for all
\(j\) is left as an exercise.

<h3 class="w3-text-teal">A Possible Computation</h3>
Assume that professor \(0, 1, 2\) can only meet on days that are
postive multiples of 2, 3, and 4, respectively.
Then the earliest time that all professors can meet
is 12.
Let's look at one of may possible system computations.

<h5 class="w3-text-teal">Initially</h5>
Initially the outgoing channels from professors 0, 1, 2 each contain
the message \(2, 3, 4\), respectively. Each channel has exactly one
message.



    <figure>
    <img src="EarliestMeetingTimeSlides/EarliestMeetingTimeSlides.003.jpeg" alt="Fig1" style="width:100%">
    <figcaption>Fig.2: Initial State</figcaption>
  </figure>

<h5 class="w3-text-teal">A First Step</h5>
Since all the channels are nonempty, the next step can be the delivery
of a message from any channel. Assume
that message \(4\)  in channel \(c_{2, 0}\) is delivered to professor \(0\). The
state of professor \(0\) changes because \(T_{0}\) becomes 4, and
this professor send message 4 on channel \(c_{0, 2}\), and so the state of this
channel becomes the sequence \([2, 4]\) with message \(2\) ahead of message
\(4\).

    <figure>
    <img src="EarliestMeetingTimeSlides/EarliestMeetingTimeSlides.004.jpeg" alt="Fig1" style="width:100%">
    <figcaption>Fig.2: A First Step</figcaption>
  </figure>


<h5 class="w3-text-teal">A Second Step</h5>
At the end of the first step, channel \(c_{2, 0}\) is
false because the channel is empty. Every other channel contains a message.
So, the next transition can be the delivery of a message from
any channel other than \(c_{2, 0}\). Suppose the next message is delivered from
channel \(c_{0, 2}\). This message is 2 because that's the message at
the head of the sequence of messages in transit along the
channel. Delivery of this message removes the message from the
channel, and the execution of this action does not change the state of
professor \(2\) because
\( (t \leq T[2]) \). The state of channel \(c_{0, 2}\) now consists of a
single message \(4\).



    <figure>
    <img src="EarliestMeetingTimeSlides/EarliestMeetingTimeSlides.005.jpeg" alt="Fig1" style="width:100%">
    <figcaption>Fig.2: A Second Step</figcaption>
  </figure>

<h5 class="w3-text-teal">A Third Step</h5>
At the end of the second step, all the channels other than \(c_{2,
0}\) are nonempty, and a
message can be delivered from any nonempty channel. Suppose the next message
delivered is the message \(4\) in channel \(c_{0, 2}\). The
delivery of this message does not change the state of professor \(2\),
and the action makes channel \(c_{0, 2}\) becomes empty.


    <figure>
    <img src="EarliestMeetingTimeSlides/EarliestMeetingTimeSlides.006.jpeg" alt="Fig1" style="width:100%">
    <figcaption>Fig.2: A Third Step</figcaption>
  </figure>


<h5 class="w3-text-teal">Following Steps</h5>
At the end of the third step the only nonempty channels are those to and from professor
\(1\). Think about further steps in the computation.
The computation
proceeds in this manner until all guards evaluate to false, i.e., all
channels are empty.

<p>
Verify that all computations end in a state in which all
channels are empty and \(T_{j} = 12\) for all \(j\).


<h4 class="w3-text-teal">Self Test</h4>
Show that the algorithm is correct for a strongly-connected graph of professors.

<h4 class="w3-text-teal">Self Test</h4>
Each agent \(j\) has a local constant \(T_{j}\) and a local variable \(v_{j}\). Given a
strongly-connected agent-channel graph, develop an algorithm that
terminates and at termination:
<p>
\(
v_{j} = \; \textrm{GCD} (\forall k: T_{k})
\)
where GCD is the greatest common divisor.

<h4 class="w3-text-teal">Self Test</h4>
Same problem as the previous case except that at termination:

<p>
\(
v_{j} = \; \textrm{LCM} (\forall k: T_{k})
\)
where LCM is the least common multiple.



<h4 class="w3-text-teal">Self Test</h4>
Generalize the results from the self tests to determine a general
algorithm which applies to all the previous self tests. The general
algorithm has a function \(f_{j}\) that is passed to each agent \(j\).

<h4 class="w3-text-teal">Optional Implementation</h4>
Implement the general algorithm using Python Pika or the Python
simulator or any language of your choice.


<!---------------------------------------->
<h5 class="w3-text-teal">Next</h5>
<!---------------------------------------->
The next page defines
<a href="BasicsStates.html">
states of a distributed system.</a>

<p>
<a href="../CODE_EXAMPLES/SumPosAndNeg.py">Examples</a>


<p>
<a href="BasicsFAQ.html">Frequenty Asked Questions</a>

<p>
<a href="BasicsReview.html">Review material for this page</a>


<!-- END MAIN -->

</body>
</html>


<!--Start Footer--------------------------------------->

    <hr class="new1">
      <p>K. Mani Chandy,
      Emeritus Simon Ramo Professor,
      California Institute of Technology</p>
    
</footer>
    


<!-- END MAIN -->
</div>

</body>
</html>



