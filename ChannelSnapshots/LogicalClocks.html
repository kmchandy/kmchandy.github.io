<title>ChannelSnapshots/LogicalClocksNew.html</title>

<!------------- Start Heading -------------------------------->
<!DOCTYPE html>

<html lang="en">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet"
href="https://www.w3schools.com/w3css/4/w3.css">

<link rel="stylesheet"
href="https://fonts.googleapis.com/css?family=Roboto">

<link rel="stylesheet"
href="https://www.w3schools.com/lib/w3-theme-blue.css">

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<style>
html,body,h1,h2,h3,h4,h5,h6 {font-family: "Roboto", sans-serif;}
.w3-sidebar {
  z-index: 3;
  width: 250px;
  top: 43px;
  bottom: 0;
  height: inherit;
}
/* Thick blue border */
hr.new2 {
  border: 2px solid blue;
}
/* blue border */
hr.new1 {
  border: 2px solid blue;
}
</style>


<body>


<div class="w3-top">
<div class="w3-bar w3-theme w3-top w3-left-align w3-large">
  
  <a class="w3-bar-item w3-button w3-right w3-hide-large
  w3-hover-white w3-large w3-theme-l1"
  href="javascript:void(0)"
  onclick="w3_open()">
  <i class="fa fa-bars"></i></a>

  <a href="../index.html"
  class="w3-bar-item w3-button w3-hide-small w3-hover-white">
  Distributed Algorithms
  </a>

  <a href="../table_of_contents.html"
  class="w3-bar-item w3-button w3-hide-small w3-hover-white">
  Contents
  </a>

  <a href="../cross_reference.html"
  class="w3-bar-item w3-button w3-hide-small w3-hover-white">
  Index
  </a>
    
  </div>
  </div>
  
  <script id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
  
<div class="w3-row w3-padding-64">
<div class="w3-twothird w3-container">
  
  <!--------------------------------------------------------->
  <!--------------------------------------------------------->
<h2 class="w3-text-teal">Local Clocks and Logical Time</h2>

<p class="w3-text-green">
  This page uses material from
  <a
  href="https://kmchandy.github.io/ChannelSnapshots/ChannelSnapshots.html">
  GlobalSnapshots.
  </a>
  </p>

  
 <!------------------------------------------------------------------->
  
  <p class="w3-text-red">
  <i>
  A logical clock algorithm assigns a value \(t(e)\) to each event
  \(e\) in a computation.

  \(t(e)\) is called the logical time of \(e\).

 Logical times have the property that all edges
 of the event graph of the computation are directed from lower to
  higher logical times.
  </i>
  </p>

  <p>
  <i>
  <p class="w3-text-red">
  A consequence of the property is that all sequences of events in
  ascending order of logical times, are computations.
  </i>
  </p>
  <!------------------------------------------------------------------->
  

  <h3 class="w3-text-teal">The Logical Time Property</h3>
A logical clock algorithm assigns a value \(t(e)\) to each event
  \(e\) of a computation so that:

  <hr class="new2">
  <h5 style="color:blue;">
  Logical Time Property
  </h5>
  <h5 style="color:blue;">
  For all edges \((e, e')\) of the event graph of the computation: \(t(e) < t(e')\).
  </h5>
  <hr class="new2">

  
  <h4 style="color:red;">Example: Logical Times of Events</h4>
  Figure 1 shows an event graph of a computation with event sequence
  \([0, 1, \ldots, 8]\) in agents \(A, B, D\).
  The numbers inside the black circles are the event ids, and the
  numbers in red adjacent to the black circles are the logical times
  of corresponding events.
  Message edges from an agent to itself are not shown, and arrows
  showing the direction of agent edges are not shown.

  <p>
  The logical times in the figure satisfy the logical time property.
  Every edge is directed from a lower to a higer logical time.
  <figure>
    <img src="../ChannelSnapshots/Timelines/Timelines.001.jpeg"
  alt="Fig1" style="width:100%"> 
    <figcaption>Fig. 1: Logical Times of Events</figcaption>
</figure>



<h4 class="w3-text-teal">Theorem: 
  Event sequences in ascending logical
  time are computations.
</h4>
<p  class="w3-text-teal">Proof</p>

Sequences in ascending order of logical time are topological sorts of the
event graph.

(Note: Ascending order means that for successive elements, where \(e'\)
follows \(e\): \(t(e') \geq t(e)\).)

  <h3 class="w3-text-teal">Logical Clock Algorithm</h3>
  The following algorithm ensures the logical time property.

  <p>
Let \(e'\) be the event immediately preceding event \(e\) at an
agent.
<ol>
  <li>
  A message sent in an event \(e\) is assigned a timestamp \(t(e)\).
  </li>
  <li>
  If the timestamp of the message received in \(e\) is \(T\) then set
  \(t(e)\) to any value greater than \(max (t(e'), T) \).
  </li>
</ol>

  <h3 class="w3-text-teal">Taking Global Snapshots using Logical Time</h3>
  The state of the set of events with logical time at most \(t\) is a
  global snapshot because the set is input closed.

  A global snapshot can be recorded as follows.

  <ol>
  <li>
  <i>Agent states</i>: Each agent records its local state
  after events with logical time at most \(t\) and before
  events with logical time greater than \(t\).
  </li>
  <li>
  <i>Channel states</i>: The state of an input channel of an agent is
  recorded by the agent as the sequence of messages with timestamps
  \(t\) or less, received on the channel, at events with logical
  time greater than \(t\).
  </li>
</ol>

<h4 style="color:red;">Example: Global Snapshot at Logical Time 2</h4>

The figure below shows events with logical time at most 2 (colored
black) and events with logical time greater than 2 (colored green).

The state of agent \(A\) after logical time 2 is the label of the edge
 for agent \(A\) from an event with with logical time 2 or less to an
event with logical time greater than 2 -- this is the edge from event 3
 to event 5.


This state is the label of the edge cut by the boundary line
separating events with logical time at most 2 from its complement.


  <figure>
    <img src="../ChannelSnapshots/Timelines/Timelines.002.jpeg"
  alt="Fig2" style="width:100%"> 
    <figcaption>Fig. 2: Global Snapshot at Logical Time 2</figcaption>
</figure>

<p>

The state of an agent is the label of the edge cut by the boundary line
separating events with logical time at most 2 from its complement.

The boundary line is shown in purple, and so the state of agents at
logical time 2 is determined by the labels of agent edges that cross
the purple line.

<p>
The state of a channel is the sequence of labels of channel edges that
cross the purple line.

For example, the state of the channel from \(B\) to \(A\) is the
sequence consisting of the message sent at event 4 and received at
event 5. 

  <!--------------------------------------------->
  <h3 class="w3-text-teal">Agent Clocks</h3>
<!--------------------------------------------->

Agents can maintain accurate clocks by using atomic clocks on PC
 boards, Precision Time Protocols (PTP) in local area networks, and
Network Time Protocol (NTP) servers.

These protocols do not, however, guarantee the logical time property.


<p>
In addition to using atomic clocks where possible, and using time
protocols such as NTP, we further modify times assigned to events so
that they satisfy the logical time property.

Times are assigned to events as follows.
A message sent in an event \(e\) is assigned a timestamp \(t(e)\),
  the clock value at the sender's clock at the point at which the
message is sent.
If the timestamp of the message received at an event \(e\) is \(T\),
and the receiver's clock when the message received is \(t\), then:

<ol>
  <li>
  If \(t < T\), then the event is assigned time \(t\).
  </li>
  <li>
  If \(t \geq T\) then the event is assigned time 
  \(T + \epsilon\) where \(\epsilon\) is positive.
  (A synchronization algorithm determines the value of \(\epsilon\).)
</ol>
The likelihood that rule 2 is used is small. 

<p>
Clocks that are synchronized in this way may not be in perfect
synchrony but have two valuable characteristics:
<ol>
  <li>
  <i>Clocks keep ticking forward</i>: For all \(T\) there exists a
  point in an infinite computation where the clocks of all agents have
  values greater than \(T\).
  </li>
  <li>
  <i>Events in time order are computations</i>: Events ordered by the
  times assigned to them by the two rules are computations.
  </li>
</ol>
We will use these characteristics in many algorithms.

<h3 class="w3-text-teal">System Monitoring is used in Many Algorithms</h3>

Monitoring systems by taking repeated snapshots is the basis of many
distributed algorithms.

A simple way to take periodic snapshots with period \(T\) is for each
agent to take its local snapshot and the snapshot of incoming channels
when its agent clock reads a multiple of \(T\).




<h4 class="w3-text-teal">Next</h4>
Next look at 
-- <a href="../Paxos/ConsensusImpossible.html">consensus algorithms</a>
or <a href="../table_of_contents.html">other types of algorithms</a>.







<!--Start Footer--------------------------------------->

    <hr class="new1">
      <p>K. Mani Chandy,
      Emeritus Simon Ramo Professor,
      California Institute of Technology</p>
    
</footer>
    


<!-- END MAIN -->
</div>

<script>
// Get the Sidebar
var mySidebar = document.getElementById("mySidebar");

// Get the DIV with overlay effect
var overlayBg = document.getElementById("myOverlay");

// Toggle between showing and hiding the sidebar, and add overlay effect
function w3_open() {
  if (mySidebar.style.display === 'block') {
    mySidebar.style.display = 'none';
    overlayBg.style.display = "none";
  } else {
    mySidebar.style.display = 'block';
    overlayBg.style.display = "block";
  }
}

// Close the sidebar with the close button
function w3_close() {
  mySidebar.style.display = "none";
  overlayBg.style.display = "none";
}
</script>

</body>
</html>
