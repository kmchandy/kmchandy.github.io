<title>TerminationDetection</title>
<!------------- Start Heading -------------------------------->
<!DOCTYPE html>

<html lang="en">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet"
href="https://www.w3schools.com/w3css/4/w3.css">

<link rel="stylesheet"
href="https://fonts.googleapis.com/css?family=Roboto">

<link rel="stylesheet"
href="https://www.w3schools.com/lib/w3-theme-blue.css">

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<style>
html,body,h1,h2,h3,h4,h5,h6 {font-family: "Roboto", sans-serif;}
.w3-sidebar {
  z-index: 3;
  width: 250px;
  top: 43px;
  bottom: 0;
  height: inherit;
}
/* Thick blue border */
hr.new2 {
  border: 2px solid blue;
}
/* blue border */
hr.new1 {
  border: 2px solid blue;
}
</style>


<body>


<div class="w3-top">
<div class="w3-bar w3-theme w3-top w3-left-align w3-large">
  
  <a class="w3-bar-item w3-button w3-right w3-hide-large
  w3-hover-white w3-large w3-theme-l1"
  href="javascript:void(0)"
  onclick="w3_open()">
  <i class="fa fa-bars"></i></a>

  <a href="../index.html"
  class="w3-bar-item w3-button w3-hide-small w3-hover-white">
  Distributed Algorithms
  </a>

  <a href="../table_of_contents.html"
  class="w3-bar-item w3-button w3-hide-small w3-hover-white">
  Contents
  </a>

  <a href="../cross_reference.html"
  class="w3-bar-item w3-button w3-hide-small w3-hover-white">
  Index
  </a>
    
  </div>
  </div>
  
  <script id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
  
<div class="w3-row w3-padding-64">
<div class="w3-twothird w3-container">

<!--------------------------------------------------------->
<h1 class="w3-text-teal">Termination Detection</h1>
<!--------------------------------------------------------->


  <!------------------------------------------------------------------->
  <p class="w3-text-red">
  A distributed computation has terminated when all agents are idle
  and all channels are empty.

  A termination detection algorithm is executed by the operating
  system to determine whether a client computation has terminated.

  </p>
  
  


  <h3 class="w3-text-teal">Problem Definition</h3>
<p>
  A computation terminates in states in which all
  channels are empty and all agents are waiting to receive messages.

  Let \(C_{s}\) and \(C_{r}\) be the numbers of messages 
  sent and received (respectively) on channel \(C\).

  <p>
  A computation is in a terminated state exactly
  when:
  <ol>
    <li>
    All agents are waiting to receive messages and
    </li>
    <li>
    for all channels \(C\):  \(\; C_{s} = C_{r}\).
    </li>
  </ol>

  The problem is to design an algorithm that detects whether the
  computation is in a terminated state.
  
<!----------------------------------------------------------------------------->
<h4 class="w3-text-teal">How Should You Solve the Problem?</h4>
<!----------------------------------------------------------------------------->

  A strategy to solve all detection problems is to start with the
  <a href="ChannelSnapshots.html">general method for detection</a> and
  then explore optimizations.

  <p>
  The general method is to take repeated global snapshots; agents send
  local information to an observer; the observer builds a global
  snapshot by putting local information together and then checks
  whether the specified condition holds in the global state.

  <p>
  Next let's explore optimizations of the general method.

  The algorithm detects when all agents are waiting.

  So, an agent need not initiate global snapshots repeatedly but only
  needs to do so when the agent starts to wait.

  <p>
  The information that an agent sends to the observer is the agent's
  local state and the state recorded on each of the agent's input
  channels.

  The algorithm only detects whether a channel is empty or not.
  So the only information that an agent needs to send the observer is
  about numbers of messages rather than content of messages.

  <p>
  Let's design an algorithm in which agents do not execute the global
  snapshot algorithm and use numbers of messages sent and
  received when agents become idle.


  <h4 class="w3-text-teal">A Termination Detection Algorithm</h4>
  Let  \(C_{s}\) and \(C_{r}\) be the numbers of messages sent and
  received (respectively) on channel \(C\).

  <p class="w3-text-teal">Agent Actions</p>
  When an agent starts to wait it sends a message to the observer.

  This message contains \(C_{s}\) for each output channel and
  \(C_{r}\) for each input channel of the agent.


  <p class="w3-text-teal">Observer Actions</p>
  The observer keeps only the latest message that it receives from
  each agent.
  
  For each channel \(C\), let \(C_{s}^{*}\) and \(C_{r}^{*}\) be the
  latest value of \(C_{s}\) and \(C_{r}\), respectively, that the
  observer has received.
  
  <p>
  Initially \(C_{s}^{*} = 0, C_{r}^{*} = -1\), and therefore
  \(C_{s}^{*} =\neq C_{r}^{*}\) for all \(C\). 

<hr class="new2">  
  <p style="color:blue;">
  The observer detects computation has terminated if
  for all channels \(C\): \(C_{s}^{*} = C_{r}^{*}\).
</p>
<hr class="new2">  

<!-------------------------------------------------------->
<h5 class="w3-text-teal">Proof of Correctness</h5>
<!-------------------------------------------------------->

  <p>
  We first prove that if the observer detects that the computation has
  terminated then the computation has indeed terminated.
Define the local snapshot of an agent as the state at which it sends
\(C_{s} = C_{s}^{*}\) for each of its output channels \(s\), and
\(C_{r} = C_{r}^{*}\) for each of its input channels \(r\).

<p>
The local snapshots correspond to a
<a href="ChannelSnapshots.html">global snapshot</a> exactly when all
messages received in the <code>past</code> are sent in the
<code>past</code>.

If \(C_{s}^{*} = C_{r}^{*}\) for all channels \(C\) then 
messages received in the <code>past</code> are sent in the
<code>past</code>.

<p>
Next we prove that if the computation terminates then the observer
detects termination.

The last message sent by each agent has \(C_{s} = C_{s}^{*}\) for each
of its output channels \(s\), and 
\(C_{r} = C_{r}^{*}\) for each of its input channels \(r\).




<h3 class="w3-text-teal">Next</h3>
Next
<a href="DatabaseDeadlockDetection.html">database deadlock
detection
</a>



<!--Start Footer--------------------------------------->

    <hr class="new1">
      <p>K. Mani Chandy,
      Emeritus Simon Ramo Professor,
      California Institute of Technology</p>
    
</footer>
    


<!-- END MAIN -->
</div>


</body>
</html>
