<title>TerminationDetection</title>
<!------------- Start Heading -------------------------------->
<!DOCTYPE html>

<html lang="en">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet"
href="https://www.w3schools.com/w3css/4/w3.css">

<link rel="stylesheet"
href="https://fonts.googleapis.com/css?family=Roboto">

<link rel="stylesheet"
href="https://www.w3schools.com/lib/w3-theme-blue.css">

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<style>
html,body,h1,h2,h3,h4,h5,h6 {font-family: "Roboto", sans-serif;}
.w3-sidebar {
  z-index: 3;
  width: 250px;
  top: 43px;
  bottom: 0;
  height: inherit;
}
/* Thick blue border */
hr.new2 {
  border: 2px solid blue;
}
/* blue border */
hr.new1 {
  border: 2px solid blue;
}
</style>


<body>


<div class="w3-top">
<div class="w3-bar w3-theme w3-top w3-left-align w3-large">
  
  <a class="w3-bar-item w3-button w3-right w3-hide-large
  w3-hover-white w3-large w3-theme-l1"
  href="javascript:void(0)"
  onclick="w3_open()">
  <i class="fa fa-bars"></i></a>

  <a href="../index.html"
  class="w3-bar-item w3-button w3-hide-small w3-hover-white">
  Distributed Algorithms
  </a>

  <a href="../table_of_contents.html"
  class="w3-bar-item w3-button w3-hide-small w3-hover-white">
  Contents
  </a>

  <a href="../cross_reference.html"
  class="w3-bar-item w3-button w3-hide-small w3-hover-white">
  Index
  </a>
    
  </div>
  </div>
  
  <script id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
  
<div class="w3-row w3-padding-64">
<div class="w3-twothird w3-container">

<!--------------------------------------------------------->
<h1 class="w3-text-teal">Termination Detection</h1>
<!--------------------------------------------------------->

  <p class="w3-text-green">
  This page uses material from
  <a
  href="../ChannelSnapshots/ChannelSnapshots.html">
  Global Snapshots and State Detection.</a>
  </p>

  <!------------------------------------------------------------------->
  <h4 class="w3-text-red">
  <i>Central Ideas</i></h4>

  <p class="w3-text-red">
  (1) Termination detection is an example of a detection
  algorithm.

  (2) Detection algorithms are based on the concepts of consistent cuts,
  global snapshots and system monitoring.
  
  <p class="w3-text-red">

  The set of states in which computation has terminated is a stable
  set of states: if computation has terminated then it remains
  terminated thereafter.
  
  Detection algorithms detect whether the state of a computation is in
  a stable set of states.

  All detection algorithms, including termination detection, are based
  on the same concepts: consistent cuts, global snapshots and system
  monitoring. 
  
  


  <h3 class="w3-text-teal">Problem Definition</h3>
  
  <p>
    An agent is either <i>idle</i> or <i>active</i>. An idle agent
    remains idle until it receives a message at which point it becomes
active. An idle agent does not send messages.

An active agent may send messages. An active agent
may become idle at any point.

<p>
    Initially all agents are active and all channels are empty.

  Computation has terminated in states in which all agents
  are idle and all channels are empty.
  The set of states in which computation has terminated is a stable
  set -- if a computation has terminated then it remains terminated.
  A computation may or may terminate.

 

<p>
    The problem is to develop an algorithm that detects that a computation
has terminated.
The detection algorithm may use messages and agents that are not part of the
  underlying computation.
  The detection algorithm must not modify the underlying computation.
  The detection algorithm has a boolean variable \(B\) which becomes
  \(True\) if and when
  the algorithm detects that computation has terminated.

  
  <h4 class="w3-text-teal">Termination Detection: Specification</h4>
  The specification of an algorithm that detects that the system state
  of a computation is in a stable set \(P\) is repeated here, for
  convenience.
  
<hr class="new2">
<h6 style="color:blue;">
<ol>
  <li>
  If at any point in a computation the system state is in \(P\) then
  there is a point in the computation after which \(B\) remains True.
  </li>
  <li>
  If \(B = True\) at any point in a computation then the system state
  at that point is in \(P\).
  </li>
</ol>
</h6>
<hr class="new2">
For the specific application of termination detection, \(P\) is the
set of states in which all agents are idle and all channels are empty.



<h3 class="w3-text-teal">The General Method Applied to Termination
Detection</h3>
<a
  href="ChannelSnapshots.html">System monitoring</a> can be used to
detect every stable property including termination.
Each agent send its local
snapshot at time \(T\) to an agent, which we call a <i>detector</i>.
The detector puts together local snapshots at \(T\) to get the global
snapshot at \(T\).
The detector obtains global snapshots repeatedly for
increasing values of \(T\). 
Initially, \(B\) is False and the detector sets \(B\) to True if
the global snapshot at \(T\), for any \(T\), shows that the underlying
computation has terminated.


<!-------------------------------------------------->
<h3 class="w3-text-teal">Algorithm for Termination
Detection without Scheduling Snapshots</h3>

<p class="w3-text-teal">The Key Idea</p>
Next, we use the concept of consistent cuts to obtain an
algorithm for termination detection without scheduling repeated snapshots.
Let \(C_{s}\) and \(C_{r}\) be the numbers of messages sent and
received (respectively) along channel \(C\).
Computation has terminated in a state in which all agents are idle and
for all channels \(C\): \(C_{s} = C_{r}\).
Let's develop an algorithm in which each agent records the numbers of
messages that it sends and receives on its incident channels.


<p class="w3-text-teal">The Algorithm</p>
Each time an agent transits from active to idle it sends \(C_{s}\)
for each of its outgoing channels \(C\),
and \(C_{r}\) for each of its incoming channels \(C\), to the
detector.
The detector keeps the latest message that it receives from each
agent.
Let \(C_{s}^{*}\) be the last value of \(C_{s}\) that the detector has
received, and
let \(C_{r}^{*}\) be the last value of \(C_{r}\) that the detector has
received.

<h4 class="w3-text-teal">The Detection Condition</h4>
<h6 style="color:blue;">
The detector detects that computation has terminated if it has
received a message from each agent and for
all channels \(C\): \(C_{s}^{*} = C_{r}^{*}\).
</h6>

<p>
The key differences between this algorithm and the system monitoring
method are as follows. In this algorithm an agent only sends
channel counts (\(C_{s}, C_{r}\)) to the detector whereas in system
monitoring each agent sends its state and states of
incoming channels. In this algorithm an agent only sends messages to
the detector when the agent transits from active to idle.  By
contrast, in system monitoring each agent sends local
snapshots to the detector repeatedly for ever increasing times \(T\),
regardless of whether the agent is active or idle.

<h4 class="w3-text-teal">Proof of Correctness</h4>

<p class="w3-text-teal">Proof of Part 1</p>

We first prove part 1 of the specification:
If the underlying computation terminates then the
 detection algorithm detects termination, i.e. sets \(B\) to True.
<p>
Assume that the underlying computation has terminated.
Let \(C_{s}^{*}\) be the number of messages sent by an agent with
output channel \(C\) when the agent transits from active to idle for
the very last time. Then \(C_{s}^{*}\) is the number of messages sent
on \(C\) when computation terminates.
By the same argument, \(C_{r}^{*}\) is the number of messages received
on \(C\) when computation terminates.
Therefore, in the last message obtained by the detector from each agent \(C_{s}^{*} =
C_{r}^{*}\). When the detector receives these messages it sets \(B\) to \(True\).



<p class="w3-text-teal">Proof of Part 2</p>

Next, we prove part 2 of the specification:
If the detector has detected that the underlying computation has
terminated, i.e., if \(B = True\), then the underlying computation has
terminated.

The key idea in proving part 2, for any stable set of states, is as
follows. The data used to detect that the system is in the stable set
of states comes from different agents at different points in a
computation. We will show that these points are a consistent cut of
the computation.

<p>
Let \(t\) be the point at which the detector sets \(B\) to \(True\).
Then at \(t\), for all channels \(C\), \(C_{s}^{*} = C_{r}^{*}\).
So, for each agent \(A\), there is a point \(t'\), earlier than \(t\), at which \(A\) sent
\(C_{s}^{*}\) for each output channel \(C\), and 
\(C_{r}^{*}\) for each input channel \(C\), to the detector.
Define a cut as follows: An event at \(A\) is in the <i>past</i> exactly when that event occurs
before \(t'\).


<p>
Because \(C_{s}^{*} = C_{r}^{*}\) the number of messages received in
the past along each channel equals the number of messages sent in the
past along that channel. So, every message received in the past is
sent in the past. Therefore the cut is consistent. So, the state
corresponding to the cut is a global snapshot.  This snapshot shows
that the underlying computation has terminated.  From the property of
global snapshots, since the global snapshot shows that the underlying
computation has terminated, it follows that the underlying computation
has, indeed, terminated. This completes the proof of part 2 of the
specification. 

<!---------------------------------------------->
<!---------------------------------------------->
<h4 class="w3-text-red">
<i>Central Ideas: Review</i></h4>
<p class="w3-text-red">

Termination detection is an example of a detection algorithm.

All detection algorithms, including termination detection, are based
  on the same concepts: consistent cuts, global snapshots and system
  monitoring.

System monitoring is a general solution for detecting stable
properties including termination.

Consistent cuts can be used to design algorithms tailored to detect
specific conditions such as termination detection.

<!---------------------------------------------->
<p class="w3-text-red">
<i>Concepts</i>:

Timelines -> causality graphs -> consistent cuts -> global snapshot
algorithms -> detection algorithms -> termination detection.


<h3 class="w3-text-teal">Next</h3>
Next either look at
<a href="DatabaseDeadlockDetection.html">database deadlock
detection</a>,
which is another detection algorithm, or move to the next topic, 
<a href="LogicalClocksNew.html">logical clocks</a>.



<!--Start Footer--------------------------------------->

    <hr class="new1">
      <p>K. Mani Chandy,
      Emeritus Simon Ramo Professor,
      California Institute of Technology</p>
    
</footer>
    


<!-- END MAIN -->
</div>

<script>
// Get the Sidebar
var mySidebar = document.getElementById("mySidebar");

// Get the DIV with overlay effect
var overlayBg = document.getElementById("myOverlay");

// Toggle between showing and hiding the sidebar, and add overlay effect
function w3_open() {
  if (mySidebar.style.display === 'block') {
    mySidebar.style.display = 'none';
    overlayBg.style.display = "none";
  } else {
    mySidebar.style.display = 'block';
    overlayBg.style.display = "block";
  }
}

// Close the sidebar with the close button
function w3_close() {
  mySidebar.style.display = "none";
  overlayBg.style.display = "none";
}
</script>

</body>
</html>
