    <h2 style="color:red;">Example: Channel Counts</h2>
    An agent that sends messages along a channel \(C\) maintains
    a local variable, \(C_{s}\), which is the number of
    messages that the agent sent along \(C\).
    An agent that receives messages along a channel \(C\) maintains
    a local variable, \(C_{r}\), which is the number of
    messages that the agent received along \(C\).
    Initially all the agents' local
    variables, \(C_{s}\) and  \(C_{r}\), are \(0\).

    <figure>
    <img src="GlobalSnapshotApplications_1.jpg" alt="Fig1" style="width:50%">
    <figcaption>Fig.1: Local Variables in Agents</figcaption>
    </figure>
    
    <p>
    The figure above shows two agents, \(A\) and \(B\), and a single
    channel \(C\) directed from \(A\) to \(B\). Agent \(A\) has a
    local variable \(C_{s}\) which is the number of messages that
    \(A\) has sent along \(C\). Agent \(B\) has a
    local variable \(C_{r}\) which is the number of messages that
\(B\) has received along \(C\).

<p>
The figure below shows a point at which \(A\) has sent 4 messages
\(m_{0}, m_{1}, m_{2}, m_{3}\), and \(A\) has received the first 2
messages \(m_{0}, m_{1}\). At this point \(C_{s}=4, C_{r}=2\) and
messages \(m_{2}, m_{3}\) are in transit along the channel.

    <figure>
    <img src="GlobalSnapshotApplications_2.jpg" alt="Fig2" style="width:50%">
    <figcaption>Fig.2: Example of local variables at some point</figcaption>
    </figure>


<h2 style="color:red;">Example: Termination Detection Algorithm Execution</h2>

<figure>
    <img src="GlobalSnapshotApplications_3.jpg" alt="Fig3" style="width:50%">
    <figcaption>Fig.3: Example of local variables at a point</figcaption>
</figure>


<p>
The figure above shows an example of possible values of variables at
some point. At this point, agent \(A\) has been continuously active
and it has sent 3 messages along channel \(C\) and received 1 message along
channel \(D\). Agent \(A\) has not sent any messages to the detector
because \(A\) has not become idle.

<p>
Agent \(B\)
became idle after receiving 1 message along channel \(C\) and sending
2 messages along channel \(D\). When agent \(B\) became idle it sent a
message to the 
detector containing \(C_{r} = 1, D_{s} = 2\).
This message is in transit from \(B\) to the detector.

<p>
The local variables, \(C'_{r}, C'_{s}, D'_{r}, D'_{s}\), of the detector
are still their initial values (i.e. 0) because the detector hasn't received
messages.


<p>
The next figure shows a possible later point. Agent \(A\)
became idle after it sent 3 messages along channel \(C\) and received
2 messages along \(D\). When it became idle \(A\) sent a message to
the detector with the values \(C_{s} = 3, D_{r} = 2\). This message is
in transit from \(A\) to the detector.

<figure>
    <img src="GlobalSnapshotApplications_4.jpg" alt="Fig4" style="width:50%">
    <figcaption>Fig.4: Example of local variables at a later point</figcaption>
</figure>

The message that \(B\) sent to the detector with values \(C_{r} = 1,
D_{s} = 2\) was received by the detector. Upon receiving this message
the detector updated values of its own local variables to \(C'_{r} = 1,
D'_{s} = 2\).

<p>
Agent \(B\) receives a message that \(A\) sent, and becomes active
upon receiving the message.

<figure>
    <img src="GlobalSnapshotApplications_5.jpg" alt="Fig5" style="width:50%">
    <figcaption>Fig.5: Example of local variables at termination</figcaption>
</figure>

The above figure shows the following case. Agent \(B\) received all
the messages that \(A\) sent to it and then \(B\) became idle. When
\(B\) became idle it sent a message \(C_{r} = 3, D_{s} = 2\). The
message was received by the detector which updated its own local
variables. The detector also received the message that \(A\) sent to
it. At this point all agents are idle, all channels are empty, and the
values of the detector's local variables  satisfy the condition
\(C'_{s} = C'_{r}, D'_{s} = D'_{r}\). Since the detector has received
a message from each agent at this point, the local termination
condition holds.



<h2 style="color:red;">Example: Timeline with Detector</h2>

<figure>
    <img src="GlobalSnapshotApplications_6.jpg" alt="Fig6" style="width:100%">
    <figcaption>Fig.6: Timelines for termination detection</figcaption>
</figure>

The above figure shows a timeline diagram for the scenario described
in the earlier figures. The system has timelines for agents \(A\) and
\(B\), and a timeline for the detector. Message lines between agents
are colored red, and message lines from agents to the detector are
colored green.
Idle periods in timelines are colored green, and active periods
are colored blue.

<p>
Agent \(A\)'s sequence of events is as follows:
<ol>
  <li>Send message.</li>
  <li>Receive message.</li>
  <li>
  Transition from active to idle. Send a message to
  the detector with \(C_{s} = 1, D_{r} = 1\). At this point, \(C_{r} =
  1, D_{s} = 2\). There is a message in transit from \(B\) to
  \(A\), and \(B\) is active. So the trajectory has not terminated.
  </li>
  <li>
  Receive a message and transition from idle to active.
  </li>
  <li>
  Send message.
  </li>
  <li>
  Send message.
  </li>
  <li>
  Transition from active to idle.
  Send a message to the detector with \(C_{s} = 3, D_{r} = 2\).
  At this point, \(C_{r} = 3, D_{s} = 2\), and both channels are
  empty.
  But agent \(B\) is still active, and so the trajectory hasn't
  terminated. 
  </li>
</ol>

<p>
Agent \(B\)'s sequence of events is as follows:
<ol>
  <li>Send message.</li>
  <li>Receive message.</li>
  <li>Send message.</li>
  <li>
  Transition from active to idle. Send a message to
  the detector with \(C_{r} = 1, D_{s} = 2\). At this point, \(C_{s} =
  3, D_{r} = 2\). There are 2 messages in transit from \(A\) to
  \(B\), and \(A\) is active. So the trajectory has not terminated.
  </li>
  <li>Receive message.</li>
  <li>Receive message.</li>
  <li>
  Transition from active to idle.
  Send a message to the detector with \(C_{r} = 3, D_{s} = 2\).
  At this point, \(C_{s} = 3, D_{r} = 2\). Both channels are
  empty and both agents are idle.
  So the trajectory has terminated. 
  </li>
</ol>

The sequence of values of the local variables of the detector is as
follows:
<ol>
  <li>
  \([C'_{s} = 0, C'_{r} = -1,  D'_{s} = 0, D'_{r} = -1]\).
  </li>
  <li>
  \([C'_{s} = 1, C'_{r} = -1,  D'_{s} = 0, D'_{r} = 1]\).
  </li>
  <li>
  \([C'_{s} = 1, C'_{r} = 1,  D'_{s} = 2, D'_{r} = 1]\).
  <li>
  \([C'_{s} = 3, C'_{r} = 1,  D'_{s} = 2, D'_{r} = 2]\).
  </li>
  <li>
  \([C'_{s} = 3, C'_{r} = 3,  D'_{s} = 2, D'_{r} = 2]\)
  Local termination condition holds.
  </li>
</ol>